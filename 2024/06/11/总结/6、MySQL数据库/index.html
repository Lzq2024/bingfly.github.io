<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="lzq">
    
    
    
    
    
    
    <title>MySQL | 冰的技术专栏</title>
    <link href="http://bingfly.top" rel="prefetch" />

    
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/bootstrap.min.js"></script>

    
<script src="/js/aos.js"></script>

    
<script src="/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/avatar.jpg'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg,preview7.jpg,preview8.jpg,preview9.jpg,preview10.jpg,preview11.jpg,preview12.jpg,preview13.jpg,preview14.jpg,preview15.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="http://bingfly.top" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>

            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="http://bingfly.top">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">冰的技术专栏</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>分类
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/hexo-%E5%8D%9A%E5%AE%A2/">hexo+博客</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Python%E5%9F%BA%E7%A1%80/">Python基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Shell/">Shell</a>
                        </li>
                        
                        
                        <li>
                            <a href="/categories">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-tags"></i>标签
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/tags/Python/">Python</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Shell/">Shell</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Linux/">Linux</a>
                        </li>
                        
                        
                        <li>
                            <a href="/tags">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                <li class="">
                    <a href="/about">
                        <i class="fa fa-user"></i>关于我
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="http://bingfly.top">冰的技术专栏</a>
        >
        <span>MySQL</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2024/06/11/%E6%80%BB%E7%BB%93/6%E3%80%81MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/">MySQL</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-tags"></i>
                
                <a href="/tags/MySQL/">MySQL</a>
                
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2024-06-11
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/6%E3%80%81MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/">MySQL</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2024-06-11
            </p>
            <p>
                
                <i class="fa fa-tags"></i>
                
                <a href="/tags/MySQL/">MySQL</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <p>[TOC]</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ThinkWon/article/details/104778621">https://blog.csdn.net/ThinkWon/article/details/104778621</a></p>
<h1 id="一、数据库管理"><a href="#一、数据库管理" class="headerlink" title="一、数据库管理"></a>一、数据库管理</h1><h2 id="1）、SQL语言分类："><a href="#1）、SQL语言分类：" class="headerlink" title="1）、SQL语言分类："></a>1）、SQL语言分类：</h2><p>DDL：（Data Definition Language，数据定义语言）：用来建立数据库、数据库对象和定义字段，如CERATE、ALTER、DROP；</p>
<p>DML：（Data Manipulation Language，数据操纵语言）：用来插入、删除和修改数据库中的数据，如INSERT、UPDATE、DELETE。</p>
<p>DQL：（Data Query Language，数据查询语言）：用来查询数据库中的数据，如SELECT。</p>
<p>DCL：（Data Control Language，数据控制语言）：用来控制数据库组件的存取许可、存取权限等，如COMMIT、ROLLBACK、GRANT、REVOKE。</p>
<h2 id="2）、创建数据库和表（DDL）："><a href="#2）、创建数据库和表（DDL）：" class="headerlink" title="2）、创建数据库和表（DDL）："></a>2）、创建数据库和表（DDL）：</h2><p>1、create database a1；</p>
<p>2、use a1；</p>
<p>3、create table a2（）；</p>
<p>4、create table 表名（字段01名称 字段01类型 字段01约束，字段02名称 字段02类型 字段02约束,…）存储引擎，字符集</p>
<p>字段01类型：</p>
<p><strong>int（4）</strong>    整型 代表0000-9999</p>
<p><strong>double</strong>      浮点型</p>
<p><strong>decimal（5,2）</strong>有效数字是5位，小数点后面保留2位 100.00；099.50</p>
<p><strong>float</strong>          单精度浮点 4字节</p>
<p><strong>char</strong>           字符</p>
<p>**char （10） **         固定长度字符串，字符串要用单引号引起来</p>
<p>**varchar（50） **    可变长度字符串</p>
<p>字段01约束：</p>
<p>非空约束： not null</p>
<p>主键约束： primary key（主键）</p>
<p>默认约束：假如没有填数据，默认预先设定的值填写 default ‘未知’</p>
<p>自增特性： auto_increment（自动增长）</p>
<p>存储引擎：myisam innodb</p>
<p>字符集：UTF-8</p>
<h2 id="3）、管理数据表中的数据："><a href="#3）、管理数据表中的数据：" class="headerlink" title="3）、管理数据表中的数据："></a>3）、管理数据表中的数据：</h2><h3 id="1、insert"><a href="#1、insert" class="headerlink" title="1、insert"></a>1、insert</h3><p><strong>insert into 表名 (字段1，字段2) values (字段1的值，字段2的值)</strong></p>
<p>或insert into 表名 values (所有字段的值)</p>
<p>查看添加的信息：select * from 表名；</p>
<h3 id="2、update"><a href="#2、update" class="headerlink" title="2、update"></a>2、update</h3><p>update 表名 set 字段名1&#x3D;值1,字段名2&#x3D;值2 where 条件表达式</p>
<h3 id="3、delete（对数据操作用delete，对库和表用drop）"><a href="#3、delete（对数据操作用delete，对库和表用drop）" class="headerlink" title="3、delete（对数据操作用delete，对库和表用drop）"></a>3、delete（对数据操作用delete，对库和表用drop）</h3><p>格式：delete from 表名 where 条件表达式（不带where代表删除表中所有记录）</p>
<h2 id="4）、数据库高级操作"><a href="#4）、数据库高级操作" class="headerlink" title="4）、数据库高级操作"></a>4）、数据库高级操作</h2><h3 id="1、清空表"><a href="#1、清空表" class="headerlink" title="1、清空表"></a>1、清空表</h3><p>delete from info；</p>
<p>truncate table info；</p>
<p>truncate清空表，表还在；drop是删除表中所有记录。</p>
<p>truncate和delete是两者的新值初始id不同。</p>
<h3 id="2、临时表"><a href="#2、临时表" class="headerlink" title="2、临时表"></a>2、临时表</h3><p>临时建立的表，用于保存一些临时数据，不会长期存在</p>
<p>create temporary table temp_info(…)engine&#x3D;innodb default charset&#x3D;utf8;</p>
<p>innodb 支持事务；写在括号外面的是对整张表的设定。</p>
<p>show tables；看不到临时表</p>
<h3 id="3、克隆表"><a href="#3、克隆表" class="headerlink" title="3、克隆表"></a>3、克隆表</h3><p>like方法：从info表完整复制结构生成test表</p>
<p>create table test like info;</p>
<p>导入数据：insert into test select * from info;</p>
<h2 id="5）、数据库用户授权"><a href="#5）、数据库用户授权" class="headerlink" title="5）、数据库用户授权"></a>5）、数据库用户授权</h2><p><strong>1、设置登录密码为abc123的lisi用户，可以从任意终端登录，对所有库和所有表有全部权限</strong>：</p>
<p>create user ‘lisi‘@’%’ identified by ‘abc123’;</p>
<p>grant all on <em>.</em> to ‘lisi‘@’%’ identified by ‘abc123’;</p>
<p><strong>2、设置登录密码为abc123的tom用户，可以从本地终端登录，对mysql库中的user表有select权限</strong></p>
<p>create user ‘tom‘@’localhost’ identified by ‘abc123’;</p>
<p>grant select on mysql.user to ‘tom‘@’abc123’ identified by ‘abc123’;</p>
<p>3、查看当前用户的权限：show grants；</p>
<p>​      查看当前系统中的用户：select user from mysql.user;</p>
<p>​      查看从本地登录的tom用户的权限：</p>
<p>​       show grants for ‘tom‘@’localhost’;</p>
<p>4、撤销用户的权限：</p>
<p>​      revoke select on mysql.user from ‘tom‘@’localhost’;</p>
<h1 id="二、索引"><a href="#二、索引" class="headerlink" title="二、索引"></a>二、索引</h1><h2 id="1、索引的概念"><a href="#1、索引的概念" class="headerlink" title="1、索引的概念"></a>1、索引的概念</h2><p>1、是一个排序的列表，存储着索引值和这个值所对应的物理地址；</p>
<p>2、无需对整个表进行扫描，通过物理地址就可以找到所需数据；</p>
<p>3、是表中一列或者若干列值排序的方法；</p>
<p>4、需要额外的磁盘空间；</p>
<p>补充：</p>
<p>索引需要的额外的磁盘空间伴随着表直接存在</p>
<p>阈值：300行以上的才建立索引，不然浪费磁盘空间</p>
<h2 id="2、索引的作用"><a href="#2、索引的作用" class="headerlink" title="2、索引的作用"></a>2、索引的作用</h2><p>1、数据库利用各种快速定位技术，能够大大加快查询速率；</p>
<p>2、当表很大或查询涉及到多个表时，可以成千上万倍地提高查询速度；</p>
<p>3、可以降低数据库的IO成本，并且还可以降低数据库的排序成本；</p>
<p>4、通过创建唯一性索引保证数据表数据的唯一性</p>
<p>IO：输入（写入、更改数据），输出（读取数据）；</p>
<p>5、可以加快表与表之间的连接；</p>
<p>6、在使用分组和排序时，可大大减少分组和排序时间</p>
<h2 id="3、索引的分类"><a href="#3、索引的分类" class="headerlink" title="3、索引的分类"></a>3、索引的分类</h2><h3 id="1）、普通索引"><a href="#1）、普通索引" class="headerlink" title="1）、普通索引"></a>1）、普通索引</h3><p>最基本的索引类型，没有唯一性之类的限制</p>
<p>1、创建表时创建</p>
<p>create table test(……index id_index(id));</p>
<p>2、直接创建</p>
<p>create index name_index on test(name);</p>
<p>3、修改表结构方式创建</p>
<p>alter table test add index id_index(id);</p>
<h3 id="2）、唯一性索引"><a href="#2）、唯一性索引" class="headerlink" title="2）、唯一性索引"></a>2）、唯一性索引</h3><p>与“普通索引”基本相同</p>
<p>与普通索引的区别是索引列的所有值只能出现一次，即必须唯一</p>
<p>1、创建表时创建</p>
<p>create table test(……unique index id_index(id));</p>
<p>2、直接创建</p>
<p>create unique index name_index on test(name);</p>
<p>3、修改表结构方式创建</p>
<p>alter table test add unique index id_index(id);</p>
<h3 id="3）、主键索引"><a href="#3）、主键索引" class="headerlink" title="3）、主键索引"></a>3）、主键索引</h3><p>是一种特殊的唯一索引，指定为“primary key”</p>
<p>一个表只能有一个主键，不允许有空值（非空且唯一）</p>
<p>1、创建表时创建</p>
<p>create table test(……primary key(id));</p>
<p>2、修改表时创建</p>
<p>alter table test add primary key(id);</p>
<h3 id="4）、组合索引（单列索引与多列索引）"><a href="#4）、组合索引（单列索引与多列索引）" class="headerlink" title="4）、组合索引（单列索引与多列索引）"></a>4）、组合索引（单列索引与多列索引）</h3><p>可以是单列上创建的索引，也可以是在多列上创建的索引</p>
<p>最左原则，从左往右依次执行</p>
<p>创建组合索引：create table test(……index ff(id,name,score));</p>
<h3 id="5）、全文索引"><a href="#5）、全文索引" class="headerlink" title="5）、全文索引"></a>5）、全文索引</h3><p>1、创建表时创建全文索引</p>
<p>create table test(……fulltext (name));</p>
<p>2、在已存在的表上创建全文索引</p>
<p>create fulltext index name_index on test(name);</p>
<p>3、通过SQL语句alter table创建全文索引</p>
<p>alter table test add fulltext index name_index(score);</p>
<h2 id="4、创建索引的原则"><a href="#4、创建索引的原则" class="headerlink" title="4、创建索引的原则"></a>4、创建索引的原则</h2><p>1、表的主键、外键必须有索引；</p>
<p>2、数据量超过300行的表应该有索引；</p>
<p>3、经常与其他表进行连接的表，在连接字段上应该建立索引；</p>
<p>4、唯一性太差的字段不适合建立索引；</p>
<p>5、更新太频繁地字段不适合创建索引；</p>
<p>6、经常出现在 Where子句中的字段，特别是大表的字段，应该建立索引；</p>
<p>7、索引应该建在选择性高的字段上；</p>
<p>8、索引应该建在小字段上，对于大的文本字段甚至超长字段，不要建索引</p>
<h2 id="5、查看索引的方法"><a href="#5、查看索引的方法" class="headerlink" title="5、查看索引的方法"></a>5、查看索引的方法</h2><p>show index from table_name\G；（\G：竖着显示）</p>
<h2 id="6、删除索引的方法"><a href="#6、删除索引的方法" class="headerlink" title="6、删除索引的方法"></a>6、删除索引的方法</h2><p>1、drop index index_name on table_name;</p>
<p>2、alter table table_name drop index index_name;</p>
<h1 id="三、事务"><a href="#三、事务" class="headerlink" title="三、事务"></a>三、事务</h1><h2 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h2><p>1、事务是一种机制、一个操作序列，包含了一组数据库操作命令，并且把所有的命令作为一个整体一起向系统提交或撤销操作请求，即这一组数据库命令要么都执行，要么都不执行；</p>
<p>2、事务是一个不可分割的工作逻辑单元，在数据库系统上执行并发操作时，事务是最小的控制单元；</p>
<p>3、适用于多用户同时操作的数据库系统的场景，如银行、保险公司及证券交易系统等等；</p>
<p>4、通过事务的整体性以保证数据的一致性；</p>
<p>5、如果事务成功了一部分，一部分未成功，则执行回滚，回到事务的起点，重新开始操作</p>
<h2 id="2、特点"><a href="#2、特点" class="headerlink" title="2、特点"></a>2、特点</h2><h3 id="1）、原子性（Atomicity）"><a href="#1）、原子性（Atomicity）" class="headerlink" title="1）、原子性（Atomicity）"></a>1）、原子性（Atomicity）</h3><p>事务是一个完整的操作，事务的各元素是不可分的</p>
<p>事务中的所有元素必须作为一个整体提交或回滚</p>
<p>如果事务中的任何元素失败，则整个事务将失败</p>
<h3 id="2）、一致性（Consistency）"><a href="#2）、一致性（Consistency）" class="headerlink" title="2）、一致性（Consistency）"></a>2）、一致性（Consistency）</h3><p>当事务完成时，数据必须处于一致状态</p>
<p>在事务开始前，数据库中存储的数据处于一致状态</p>
<p>在正在进行的事务中，数据可能处于不一致的状态</p>
<p>当事务成功完成时，数据必须再回到已知的一致状态</p>
<h3 id="3）、隔离性（Isolation）"><a href="#3）、隔离性（Isolation）" class="headerlink" title="3）、隔离性（Isolation）"></a>3）、隔离性（Isolation）</h3><p>对数据进行修改的所有并发事务是彼此隔离的，表明事务必须是独立的，它不应以任何方式依赖于或影响其他事务</p>
<p>修改数据的事务可在另一个使用相同数据的事务开始之前访问这些数据，或者在另一个使用相同数据的事务结束之后访问这些数据</p>
<h3 id="4）、持久性"><a href="#4）、持久性" class="headerlink" title="4）、持久性"></a>4）、持久性</h3><p>指不管系统是否发生故障，事务处理的结果都是永久的</p>
<p>一旦事务被提交，事务的效果会被永久地保留在数据库中</p>
<h2 id="3、控制语句"><a href="#3、控制语句" class="headerlink" title="3、控制语句"></a>3、控制语句</h2><p>1、MySQL事务默认是自动提交的，当SQL语句提交时事务便自动提交；</p>
<p>2、事务控制语句</p>
<p>begin             事务的开始</p>
<p>commit         提交</p>
<p>rollback         回滚</p>
<p>savepoint  存档点名称                         存档点</p>
<p>release savepoint  存档点名称           删除存档点</p>
<p>rollback to  存档点名称                        回滚到某个存档点</p>
<p>set transaction                                      设置事务</p>
<p>set autocommit&#x3D;0                                禁止自动提交</p>
<p>set autocommit&#x3D;1                                开启自动提交（默认）</p>
<h2 id="4、事务的操作"><a href="#4、事务的操作" class="headerlink" title="4、事务的操作"></a>4、事务的操作</h2><p>创建的数据表存储引擎必须是innodb，才支持事务（5.7版本默认就是innodb）</p>
<p>具体操作：</p>
<p>1、begin;</p>
<p>​      insert into test values(1,’zhangsan’);</p>
<p>​      commit;（结束事务）</p>
<p>2、begin;</p>
<p>​      insert into test values(1,’zhangsan’);</p>
<p>​      savepoint a;</p>
<p>​      savepoint b;</p>
<p>​      rollback to b;</p>
<p>​      rollback to a</p>
<p>​      注意：只能向前回滚，无法向后回滚</p>
<p>3、三种情况事务开始：</p>
<p>begin；</p>
<p>set autocommit&#x3D;0；</p>
<p>start transaction</p>
<p>三种情况结束事务：</p>
<p>commit；</p>
<p>set autocommit&#x3D;1；</p>
<p>rollback</p>
<h1 id="四、操作引擎"><a href="#四、操作引擎" class="headerlink" title="四、操作引擎"></a>四、操作引擎</h1><h2 id="1、概念-1"><a href="#1、概念-1" class="headerlink" title="1、概念"></a>1、概念</h2><p>1、MySQL中的数据用各种不同的技术存储在文件中，每一种技术都使用不同的存储机制、索引技巧、锁定水平并最终提供不同的功能和能力，这些不同的技术以及配套的功能在 MySQL中称为存储引擎</p>
<p>2、存储引擎就是 MySQL将数据存储在文件系统中的存储方式或者存储格式</p>
<p>3、目前 MySQL常用的两种存储引擎</p>
<p>MyISAM</p>
<p>InnoDB</p>
<p>（innodb支持事务，myisam不支持事务）</p>
<p>4、MySQL存储引擎是 MySQL数据库服务器中的组件，负责为数据库执行实际的数据I&#x2F;O操作</p>
<p>使用特殊存储引擎的主要优点之一在于：</p>
<p>仅需提供特殊应用所需的特性</p>
<p>数据库中的系统开销较小</p>
<p>具有更有效和更高的数据库性能</p>
<p>5、MySQL系统中，存储引擎处于文件系统之上，在数据保存到数据文件之前会传输到存储引擎，之后按照各个存储引擎的存储格式进行存储</p>
<h2 id="2、Myisam"><a href="#2、Myisam" class="headerlink" title="2、Myisam"></a>2、Myisam</h2><h3 id="1）、特点："><a href="#1）、特点：" class="headerlink" title="1）、特点："></a>1）、特点：</h3><p>1、<strong>myisam不支持事务，也不支持外键</strong></p>
<p>2、访问速度快</p>
<p>3、对事物完整性没有要求</p>
<p>4、myisam在磁盘上存储成三个文件</p>
<p>.frm文件存储表定义</p>
<p>数据文件的扩展名为.MYD(MYData)</p>
<p>索引文件的扩展名是.MYI(MYIndex)</p>
<p>5、<strong>表级锁定形式</strong>，数据在更新时锁定整个表（不允许两个人同时操作）</p>
<p>6、数据库在读写过程中相互阻塞</p>
<p>会在数据写入的过程阻塞用户数据的读取，也会在数据读取的过程中阻塞用户的数据写入</p>
<p>7、数据单独写入或读取，速度过程较快且占用资源相对少</p>
<p>8、myisam</p>
<p>静态表</p>
<p>动态表 （直接写入的，数据会随时变的）</p>
<p>压缩表</p>
<h3 id="2）、适用生产场景"><a href="#2）、适用生产场景" class="headerlink" title="2）、适用生产场景"></a>2）、适用生产场景</h3><p>1、公司业务不需要事务的支持</p>
<p>2、单方面读取或写入数据比较多的业务</p>
<p>3、myisam存储引擎数据读写都比较频繁场景不适合</p>
<p>4、使用读写并发访问相对较低的业务</p>
<p>5、数据修改相对较少的业务</p>
<p>6、对数据业务一致性要求不是非常高的业务</p>
<p>7、服务器硬件资源相对比较差</p>
<h2 id="3、Innodb"><a href="#3、Innodb" class="headerlink" title="3、Innodb"></a>3、Innodb</h2><h3 id="1）、特点：-1"><a href="#1）、特点：-1" class="headerlink" title="1）、特点："></a>1）、特点：</h3><p>1、<strong>支持事务：支持4个事务隔离级别</strong></p>
<p>2、<strong>行级（读写分离）锁定</strong>，但是全表扫描仍然会是表级锁定</p>
<p>3、读写阻塞与事务隔离级别相关</p>
<p>4、具有非常高效的缓存特性：能缓存索引，也能缓存数据</p>
<p>5、表与主键以簇的方式存储</p>
<p>6、支持外键约束，5.5以前不支持全文索引，5.5版本以后支持全文索引</p>
<p>7、对硬件资源要求还是比较高的场合</p>
<h3 id="2）、适用生产场景-1"><a href="#2）、适用生产场景-1" class="headerlink" title="2）、适用生产场景"></a>2）、适用生产场景</h3><p>1、业务需要事务的支持</p>
<p>2、行级锁定对高并发有很好的适应能力，但需确保查询是通过索引来完成</p>
<p>3、业务数据更新较为频繁的场景，如：论坛、微博等</p>
<p>4、业务数据一致性要求较高，如：银行业务</p>
<p>5、硬件设备内存较大（因为事务都先放内存），利用innodb较好的缓存能力来提高内存利用率，减少磁盘IO的压力</p>
<h2 id="4、修改存储引擎"><a href="#4、修改存储引擎" class="headerlink" title="4、修改存储引擎"></a>4、修改存储引擎</h2><p>1、alter table 修改</p>
<p>alter table table_name engine&#x3D;引擎；</p>
<p>2、修改my.cnf，指定默认存储引擎并重启服务</p>
<p>在[mysqld]下面添加default-storage-engine&#x3D;InnoDB</p>
<p>3、create table创建表时指定存储引擎</p>
<p>create table 表名（字段）engine&#x3D;引擎</p>
<p>4、Mysql_convert_table_format转化存储引擎</p>
<p>Mysql_convert_table_format –user&#x3D;root –password&#x3D;密码</p>
<p>–sock&#x3D;&#x2F;tmp&#x2F;mysql.sock-engine&#x3D;引擎 库名 表名</p>
<h1 id="五、备份与恢复"><a href="#五、备份与恢复" class="headerlink" title="五、备份与恢复"></a>五、备份与恢复</h1><h2 id="1、备份的分类"><a href="#1、备份的分类" class="headerlink" title="1、备份的分类"></a>1、备份的分类</h2><h3 id="1）、从物理和逻辑的角度"><a href="#1）、从物理和逻辑的角度" class="headerlink" title="1）、从物理和逻辑的角度"></a>1）、从物理和逻辑的角度</h3><p>1、物理备份：</p>
<p>对数据库操作系统的物理文件（如数据文件、日志文件等）的备份</p>
<p>冷备份（脱机备份）：是在关闭数据库的时候进行的</p>
<p>热备份（联机备份）：数据库处于运行状态，依赖于数据库的日志文件</p>
<p>温备份：数据库锁定表格（不可写入但可读）的状态下进行备份操作</p>
<p>2、逻辑备份：对数据库逻辑组件（如：表等数据库对象）的备份</p>
<h3 id="2）、从数据库的备份策略角度"><a href="#2）、从数据库的备份策略角度" class="headerlink" title="2）、从数据库的备份策略角度"></a>2）、从数据库的备份策略角度</h3><p>1、完全备份：每次对数据库进行完整的备份</p>
<p>2、差异备份：备份自从上次完全备份之后被修改过的文件</p>
<p>3、增量备份：只有在上次完全备份或者增量备份后被修改的文件才会被备份</p>
<h2 id="2、常见的备份方法"><a href="#2、常见的备份方法" class="headerlink" title="2、常见的备份方法"></a>2、常见的备份方法</h2><h3 id="1）、物理冷备"><a href="#1）、物理冷备" class="headerlink" title="1）、物理冷备"></a>1）、物理冷备</h3><p>备份时数据库处于关闭状态，直接打包数据库文件</p>
<p>备份速度快，恢复时也是最简单的</p>
<h3 id="2）、专业备份工具mysqldump或mysqlhotcopy"><a href="#2）、专业备份工具mysqldump或mysqlhotcopy" class="headerlink" title="2）、专业备份工具mysqldump或mysqlhotcopy"></a>2）、专业备份工具mysqldump或mysqlhotcopy</h3><p>mysqldump常用的逻辑备份工具</p>
<p>mysqlhotcopy仅拥有备份MyISAM和ARCHIVE表</p>
<h3 id="3）、启用二进制日志进行增量备份"><a href="#3）、启用二进制日志进行增量备份" class="headerlink" title="3）、启用二进制日志进行增量备份"></a>3）、启用二进制日志进行增量备份</h3><p>进行增量备份，需要刷新二进制日志</p>
<h3 id="4）、第三方工具备份"><a href="#4）、第三方工具备份" class="headerlink" title="4）、第三方工具备份"></a>4）、第三方工具备份</h3><p>免费的MySQL热备份软件Percona XtraBackup</p>
<h2 id="3、完全备份"><a href="#3、完全备份" class="headerlink" title="3、完全备份"></a>3、完全备份</h2><h3 id="1）、简介"><a href="#1）、简介" class="headerlink" title="1）、简介"></a>1）、简介</h3><p>1、是对整个数据库、数据库结构和文件结构的备份</p>
<p>2、保存的是备份完成时刻的数据库</p>
<p>3、是差异备份与增量备份的基础</p>
<p>4、每次对数据进行完整的备份，完全备份是增量备份的基础，完全备份保存的是备份完成时刻的数据库</p>
<h3 id="2）、优点"><a href="#2）、优点" class="headerlink" title="2）、优点"></a>2）、优点</h3><p>备份与恢复操作简单方便</p>
<h3 id="3）、缺点"><a href="#3）、缺点" class="headerlink" title="3）、缺点"></a>3）、缺点</h3><p>数据存在大量的重复</p>
<p>占用大量的备份空间</p>
<p>备份与恢复时间长</p>
<h3 id="4）、分类"><a href="#4）、分类" class="headerlink" title="4）、分类"></a>4）、分类</h3><h4 id="1、物理冷备份与恢复"><a href="#1、物理冷备份与恢复" class="headerlink" title="1、物理冷备份与恢复"></a>1、物理冷备份与恢复</h4><p>关闭MySQL数据库</p>
<p>使用tar命令直接打包数据库文件夹（&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data）</p>
<p>直接替换现有MySQL目录即可</p>
<h4 id="2-、mysqldump备份与恢复"><a href="#2-、mysqldump备份与恢复" class="headerlink" title="2)、mysqldump备份与恢复"></a>2)、mysqldump备份与恢复</h4><p>MySQL自带的备份工具，可方便实现对MySQL的备份</p>
<p>可以将指定的库、表导出为SQL脚本（.sql结尾）</p>
<p>使用命令MySQL导入备份的数据</p>
<p>操作步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p --all-databses &gt; all-data-$(date +%F).sql ###备份所有数据库</span><br><span class="line"></span><br><span class="line">mysqldump -u root -p -databases auth mysql &gt; auth-mysql.sql ###备份auth和mysql库</span><br><span class="line"></span><br><span class="line">mysqldump -u root -p auth &gt; auth-$(data +%F).sql ###备份auth数据库</span><br><span class="line"></span><br><span class="line">mysqldump -u root -p mysql user &gt; mysql-user-$(date +%F).sql ###备份mysql的user表</span><br><span class="line"></span><br><span class="line">mysqldump -u root -p -d mysql user &gt; /tmp/desc-mysql-user.sql ###备份mysql库user表的结构</span><br></pre></td></tr></table></figure>



<p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mysqldump -u root -p test &gt; test-$(date +%F).sql</span><br><span class="line"></span><br><span class="line">mysql&gt; drop database test;</span><br><span class="line"></span><br><span class="line">mysql&gt; create database test2; ###建立空库</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysql -u root -p test2 &lt; test-2020-10-23.sql</span><br></pre></td></tr></table></figure>



<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mysqldump -u root -p test &gt; test-$(date +%F).sql</span><br><span class="line"></span><br><span class="line">mysql&gt; drop database test;</span><br><span class="line"></span><br><span class="line">mysql&gt; create database test2;</span><br><span class="line"></span><br><span class="line">mysql&gt; use test2;</span><br><span class="line"></span><br><span class="line">mysql&gt; source /root/test-2020-10-24.sql;</span><br></pre></td></tr></table></figure>



<h2 id="4、增量备份"><a href="#4、增量备份" class="headerlink" title="4、增量备份"></a>4、增量备份</h2><p>1、使用mysqldump进行完全备份存在的问题</p>
<p>备份数据中有重复数据</p>
<p>备份时间与恢复时间过长</p>
<p>2、MySQL增量备份是自上一次备份后增加&#x2F;变化的文件或者内容</p>
<p>3、特点</p>
<p>没有重复数据，备份量不大，时间短</p>
<p>恢复需要上次完全备份及完全备份之后所有的增量备份才能恢复，而且要对所有增量备份进行逐个反推恢复</p>
<p>4、MySQL没有提供直接的增量备份方法</p>
<p>可通过MySQL提供的二进制日志间接实现增量备份</p>
<p>5、MySQL二进制日志对备份的意义</p>
<p>二进制日志保存了所有更新或者可能更新数据库的操作</p>
<p>二进制日志在启动MySQL服务器后开始记录，并在文件达到max_binlog_size所设置的大小或者接收到flush logs命令后重新创建新的日志文件</p>
<p>只需定时执行flush logs方法重新创建新的日志，生成二进制文件序列，并及时把这些日志保存到安全的地方就完成了一个时间段的增量备份</p>
<h2 id="5、增量恢复"><a href="#5、增量恢复" class="headerlink" title="5、增量恢复"></a>5、增量恢复</h2><h3 id="1）、一般恢复"><a href="#1）、一般恢复" class="headerlink" title="1）、一般恢复"></a>1）、一般恢复</h3><p>将所有备份的二进制日志内容全部恢复</p>
<h3 id="2）、断点恢复"><a href="#2）、断点恢复" class="headerlink" title="2）、断点恢复"></a>2）、断点恢复</h3><h4 id="1、基于位置恢复"><a href="#1、基于位置恢复" class="headerlink" title="1、基于位置恢复"></a>1、基于位置恢复</h4><p>数据库在某一时间点可能既有错误的操作也有正确的操作</p>
<p>可以基于精准的位置跳过错误的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mkdir -p /opt/bak_sql</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqldump -uroot -p test2 &gt; /opt/bak_sql/test2-$(date +%F).sql; ###完整备份</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">log_bin=/usr/local/mysql/data/mysql_bin ###开启增量备份</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqladmin -uroot -p flush-logs ###将二进制日志更新，产生新的日志文件</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# cd /usr/local/mysql/data/</span><br><span class="line"></span><br><span class="line">[root@server1 data]# ll ###查询增量备份结果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --base64-output=decode-rows -v /usr/local/mysql/data/mysql_bin.000002 ###查询该二进制日志内容是否正确</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqladmin -u root -p flush-logs; ###将二进制日志更新，产生新的日志文件</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# cd /usr/local/mysql/data/</span><br><span class="line"></span><br><span class="line">[root@server1 data]# ll ###查询增量备份结果</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --base64-output=decode-rows -v /usr/local/mysql/data/mysql_bin.000003 ###查询该二进制日志内容是否正确</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; use test2;</span><br><span class="line"></span><br><span class="line">mysql&gt; drop table aa; ###先删掉坏的那张表</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysql -u root -p test2 &lt; /opt/bak_sql/test2-2020-10-24.sql ###还原完全备份的数据库</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --base64-output=decode-rows -v /usr/local/mysql/data/mysql_bin.000002 ###查询该二进制日志内容</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --stop-datetime=&#x27;2020-10-24  0:55:25&#x27; /usr/local/mysql/data/mysql_bin.000002 | mysql -u root -p ###停止错误的时间</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --start-datetime=&#x27;2020-10-24  0:55:48&#x27; /usr/local/mysql/data/mysql_bin.000002 | mysql -u root -p ###开始正确的时间</span><br></pre></td></tr></table></figure>



<h4 id="2、基于时间点恢复"><a href="#2、基于时间点恢复" class="headerlink" title="2、基于时间点恢复"></a>2、基于时间点恢复</h4><p>跳过某个发生错误的时间点实现数据恢复</p>
<p>前面步骤同基于时间恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --base64-output=decode-rows -v /usr/local/mysql/data/mysql_bin.000003 ###查询该二进制日志内容</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --stop-position=&#x27;2168&#x27; /usr/local/mysql/data/mysql_bin.000003 | mysql -u root -p ###上一次操作正确的位置点停止</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# mysqlbinlog --no-defaults --start-position=&#x27;2537&#x27; /usr/local/mysql/data/mysql_bin.000003 | mysql -u root -p ###下一次操作正确的位置点开始</span><br></pre></td></tr></table></figure>



<h2 id="六、主从复制"><a href="#六、主从复制" class="headerlink" title="六、主从复制"></a>六、主从复制</h2><p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210118144957.png" alt="1607438780286"></p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210222144821.png" alt="image-20210222144816009"></p>
<h2 id="1、原理"><a href="#1、原理" class="headerlink" title="1、原理"></a>1、原理</h2><p>1、Master将用户对数据库更新的操作以二进制格式保存到Binary Log日志文件中；</p>
<p>2、Slave上面的IO进程连接上Master，并请求从指定日志文件的指定位置（或者从最开始的日志）之后的日志内容；</p>
<p>3、Master接收来自Slave的IO进程的请求后，通过负责复制的IO进程根据请求信息读取制定日志指定位置之后的日志信息，返回给Slave的IO进程。返回信息中除了日志所包含的信息之外，还包括本次返回的信息已经到Master端的bin-log文件的名称以及bin-log的位置；</p>
<p>4、Slave的IO进程接收到信息后，将接收到的日志内容依次添加到Slave端的relay-log文件的最末端，并将读取到的Master端的bin-log的文件名和位置记录到master-info文件中，以便在下一次读取的时候能够清除的告诉Master“我需要从某个bin-log的哪个位置开始往后的日志内容，请发给我”；</p>
<p>5、Slave的Sql进程检测到relay-log中新增了内容后，会马上解析relay-log的内容称为在Master端真实执行时候的那些可执行的内容，并在自身执行。</p>
<h2 id="故障及解决方法"><a href="#故障及解决方法" class="headerlink" title="故障及解决方法"></a>故障及解决方法</h2><p>MySQL复制方式：</p>
<p>半同步复制 –》同步速度慢一点能保证slave同步二进制日志的完整性</p>
<p>异步复制–》同步速度快，但是不能确保二进制日志确实到达slave上</p>
<p>在半同步复制的架构下，当master在将自己binlog发给slave上的时候，要确保slave已经接受到了这个二进制日志以后，才会返回数据给客户端。</p>
<p>对比两种架构：异步复制对于用户来说，可以确保得到快速的响应结构，但是不能确保二进制日志确实到达了slave上；半同步复制对于客户的请求响应稍微慢点，但是他可以保证二进制日志的完整性。</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>故障一：</p>
<h3 id="开发设置的crontab计划任务周期不合理："><a href="#开发设置的crontab计划任务周期不合理：" class="headerlink" title="开发设置的crontab计划任务周期不合理："></a>开发设置的crontab计划任务周期不合理：</h3><p>感觉前端的页面（LAMP）打开有点延迟，平时正常都很快就加载出来了，查找原因：</p>
<p>发现数据库占满了，因为数据要从数据库拿，影响了读取速度；</p>
<p>问题：周期性计划开发设计不合理，本来1个小时的，结果三分钟一次写业务数据到数据库，导致那个数据库很大占满了，</p>
<p>解决方法：通知开发去修改</p>
<p>故障二：</p>
<h3 id="MySQL中主从延迟高，怎么解决？"><a href="#MySQL中主从延迟高，怎么解决？" class="headerlink" title="MySQL中主从延迟高，怎么解决？"></a>MySQL中主从延迟高，怎么解决？</h3><p>主从同步的延迟的原因：</p>
<p>我们知道， 一个服务器开放Ｎ个链接给客户端来连接的，这样有会有大并发的更新操作, 从服务器通过I&#x2F;O的线程去主服务器同步二进制日志，当某个SQL在从服务器上执行的时间稍长 或者由于某个SQL要进行锁表就会导致主服务器的SQL大量积压，未被同步到从服务器里。这就导致了主从不一致，也就是主从延迟。</p>
<h3 id="主从同步延迟的解决办法："><a href="#主从同步延迟的解决办法：" class="headerlink" title="主从同步延迟的解决办法："></a>主从同步延迟的解决办法：</h3><p>软件方面：</p>
<p>因为所有的SQL必须都要在从服务器里面执行一遍，但是主服务器如果不断的有更新操作源源不断的写入，那么一旦有延迟产生，那么延迟加重的可能性就会原来越大。 当然我们可以做一些缓解的措施。</p>
<p>a. 我们知道因为主服务器要负责更新操作， 他对安全性的要求比从服务器高， 所有有些设置可以修改，比如sync_binlog&#x3D;1，innodb_flush_log_at_trx_commit &#x3D; 1 之类的设置，而slave则不需要这么高的数据安全，完全可以将sync_binlog设置为0或者关闭binlog，innodb_flushlog，innodb_flush_log_at_trx_commit 也可以设置为0来提高sql的执行效率 这个能很大程度上提高效率。另外就是使用比主库更好的硬件设备作为slave。</p>
<p>b. 就是把，一台从服务器当作为备份使用，而不提供查询，那边他的负载下来了，执行relay log 里面的SQL效率自然就高了。</p>
<p> 硬件方面：</p>
<p>1.主或者从服务器负载过高，给服务器扩容；</p>
<p>2.增加从服务器，这个目的还是分散读的压力， 从而降低服务器负载。</p>
<h3 id="3-判断主从延迟的方法"><a href="#3-判断主从延迟的方法" class="headerlink" title="3.判断主从延迟的方法"></a>3.判断主从延迟的方法</h3><p>可以通过 show slave status 进行查看，比如可以看看Seconds_Behind_Master参数的值来判断，是否有发生主从延时。</p>
<p>其值有这么几种：</p>
<p>NULL - 表示io_thread或是sql_thread有任何一个发生故障，也就是该线程的Running状态是No,而非Yes.</p>
<p>0 - 该值为零，是我们极为渴望看到的情况，表示主从复制状态正常</p>
<h2 id="2、主服务器（Master）"><a href="#2、主服务器（Master）" class="headerlink" title="2、主服务器（Master）"></a>2、主服务器（Master）</h2><h3 id="1）、日志文件"><a href="#1）、日志文件" class="headerlink" title="1）、日志文件"></a>1）、日志文件</h3><p>修改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server-id=1 ###mysql服务器id，每个服务器不能相同</span><br><span class="line"></span><br><span class="line">log_bin=master-bin ###主服务器日志文件</span><br><span class="line"></span><br><span class="line">log_slave_updates=true ###允许中继日志读取主服务器的二进制日志</span><br></pre></td></tr></table></figure>



<h3 id="2）、授权"><a href="#2）、授权" class="headerlink" title="2）、授权"></a>2）、授权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to &#x27;myslave&#x27;@&#x27;192.168.73.%&#x27; identified by &#x27;abc123&#x27;; ###为所有从服务器授权所有数据库</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>



<h3 id="3）、记录日志文件及位置点"><a href="#3）、记录日志文件及位置点" class="headerlink" title="3）、记录日志文件及位置点"></a>3）、记录日志文件及位置点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status; ###记下二进制日志文件及position的值</span><br></pre></td></tr></table></figure>



<h2 id="3、从服务器"><a href="#3、从服务器" class="headerlink" title="3、从服务器"></a>3、从服务器</h2><h3 id="1）、日志文件-1"><a href="#1）、日志文件-1" class="headerlink" title="1）、日志文件"></a>1）、日志文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server-id = 12 ###MySQL服务器的id，需要配置不同数字</span><br><span class="line"></span><br><span class="line">relay_log=relay-log-bin ###从主服务器上同步日志文件记录到本地中继日志</span><br><span class="line"></span><br><span class="line">relay_log_index=slave-relay-bin.index ###定义中继日志的索引</span><br></pre></td></tr></table></figure>



<h3 id="2）、与Master同步"><a href="#2）、与Master同步" class="headerlink" title="2）、与Master同步"></a>2）、与Master同步</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; change master to master_host=&#x27;192.168.73.10&#x27;,master_user=&#x27;myslave&#x27;,master_password=&#x27;abc123&#x27;,master_log_file=&#x27;master-bin.000001&#x27;,master_log_pos=863;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave; ###启动从服务器</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G ###查看从服务器状态</span><br><span class="line"></span><br><span class="line">...省略</span><br><span class="line"></span><br><span class="line"> Slave_IO_Running: Yes </span><br><span class="line"></span><br><span class="line"> Slave_SQL_Running: Yes ###这两项需要为YES</span><br></pre></td></tr></table></figure>



<h3 id="3）、主从复制失败原因"><a href="#3）、主从复制失败原因" class="headerlink" title="3）、主从复制失败原因"></a>3）、主从复制失败原因</h3><p>1、I&#x2F;O线程显示为NO: 主库与从库网络不通、主库未授权给从库、</p>
<p>2、SQL线程显示为NO：从库日志和位置点与主不同步</p>
<p>3、若从库查看连接主库I&#x2F;0线程状态为conneting，一直是这个状态，考虑双方的防火墙是否开启。</p>
<h1 id="七、读写分离"><a href="#七、读写分离" class="headerlink" title="七、读写分离"></a>七、读写分离</h1><h2 id="1、原理-1"><a href="#1、原理-1" class="headerlink" title="1、原理"></a>1、原理</h2><p>1、只在主服务器上写，只在从服务器上读</p>
<p>2、主数据库处理事务性查询，从数据库处理select查询</p>
<p>3、数据库复制用于将事务性查询的变更同步到集群中的从数据库</p>
<p>读写分离原理示意图</p>
<h2 id="2、部署amoeba"><a href="#2、部署amoeba" class="headerlink" title="2、部署amoeba"></a>2、部署amoeba</h2><p>基于读写分离</p>
<h3 id="1）、安装jdk环境"><a href="#1）、安装jdk环境" class="headerlink" title="1）、安装jdk环境"></a>1）、安装jdk环境</h3><h3 id="2）、部署amoeba代理"><a href="#2）、部署amoeba代理" class="headerlink" title="2）、部署amoeba代理"></a>2）、部署amoeba代理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@amoeba opt]# unzip amoeba-mysql-3.0.5-RC-distribution.zip -d /usr/local </span><br><span class="line"></span><br><span class="line">[root@amoeba ~]# mv /usr/local/amoeba-mysql-3.0.5-RC/ /usr/local/amoeba </span><br><span class="line"></span><br><span class="line">[root@amoeba ~]# chmod -R 755 /usr/local/amoeba/ </span><br><span class="line"></span><br><span class="line">[root@amoeba ~]# vim /usr/local/amoeba/jvm.properties 32 #JVM_OPTIONS=&quot;-server -Xms256m -Xmx1024m -Xss196k -XX:PermSize=16m -XX:MaxPe    rmSize=96m&quot; 33 JVM_OPTIONS=&quot;-server -Xms1024m -Xmx1024m -Xss256k&quot; </span><br></pre></td></tr></table></figure>



<h3 id="3）、在MySQL上给amoeba授权"><a href="#3）、在MySQL上给amoeba授权" class="headerlink" title="3）、在MySQL上给amoeba授权"></a>3）、在MySQL上给amoeba授权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all on *.* to &#x27;test&#x27;@&#x27;192.168.73.%&#x27; identified by &#x27;abc123&#x27;; </span><br></pre></td></tr></table></figure>



<h3 id="4）、修改配置文件"><a href="#4）、修改配置文件" class="headerlink" title="4）、修改配置文件"></a>4）、修改配置文件</h3><h4 id="1、amoeba-xml"><a href="#1、amoeba-xml" class="headerlink" title="1、amoeba.xml"></a>1、amoeba.xml</h4><p>1、修改连接amoeba使用的用户名和密码</p>
<p>2、给master开放默认池和写池，给slave开放读池</p>
<h4 id="2、dbServer-xml"><a href="#2、dbServer-xml" class="headerlink" title="2、dbServer.xml"></a>2、dbServer.xml</h4><p>1、指定为amoeba创建的允许读取数据库的用户名和密码（5.7版本没有默认的test数据库）</p>
<p>2、配置三个服务器的主机名和地址</p>
<p>3、指定名为slaves的poolName中pools的主机名</p>
<h1 id="八、MHA高可用及故障切换"><a href="#八、MHA高可用及故障切换" class="headerlink" title="八、MHA高可用及故障切换"></a>八、MHA高可用及故障切换</h1><h2 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h2><p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210118145004.png" alt="1607583491440"></p>
<p>1、传统的MySQL主从架构存在的问题</p>
<p>MySQL主服务器出故障后就无法写入数据了</p>
<p>2、MHA简介<br>一套优秀的MySQL高可用环境下故障切换和主从复制的软件<br>MySQL故障过程中，MHA能做到0-30秒内自动完成故障切换</p>
<p>3、MHA组成<br>MHA Manager（管理节点）和 MHA Node（数据节点）<br>MHA Manager 可以单独部署在一台独立的机器上，管理多个 master-slave 集群（Manger是单独一台监控master服务器健康状态的服务器。）；也可以部署在一台 slave 节点上。MHA Node 运行在每台 MySQL 服务器上，MHA Manager 会定时探测集群中的 master 节点。当 master 出现故障时，它可以自动将最新数据的 slave 提升为新的 master，然后将所有其他的 slave 重新指向新的 master。整个故障转移过程对应用程序完 全透明。</p>
<p>4、MHA特点（优势）<br>在 MHA 自动故障切换过程中，MHA 试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过 SSH 访问，MHA 没法保存二进制日志，就会出现只进行故障转移但丢失了最新的数据的情况。<br>使用 MySQL 5.5 的半同步复制，可以大大降低数据丢失的风险。MHA 可以与半同步复 制结合起来。如果只有一个 slave 已经收到了最新的二进制日志，MHA 可以将最新的二进 制日志应用于其他所有的 slave 服务器上，因此可以保证所有节点的数据一致性。</p>
<p>5、MHA架构<br>目前MHA支持一主多从架构，最少三台服务，即一主两从</p>
<h2 id="2、具体配置"><a href="#2、具体配置" class="headerlink" title="2、具体配置"></a>2、具体配置</h2><h3 id="1）、配置一主两从"><a href="#1）、配置一主两从" class="headerlink" title="1）、配置一主两从"></a>1）、配置一主两从</h3><p>MySQL主配置文件修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Master ~]# vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server-id = 1</span><br><span class="line">log_bin = master-bin</span><br><span class="line">log-slave-updates = true</span><br></pre></td></tr></table></figure>



<p>MySQL从服务器配置：</p>
<p>1、主备服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Slave1 ~]# vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server-id = 2</span><br><span class="line">log_bin = master-bin</span><br><span class="line">relay_log = relay-log-bin</span><br><span class="line">relay_log_index = slave-relay-bin.index</span><br></pre></td></tr></table></figure>

<p>2、从服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Slave2 ~]# vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server-id = 3</span><br><span class="line">relay_log = relay-log-bin</span><br><span class="line">relay_log_index = slave-relay-bin.index</span><br></pre></td></tr></table></figure>



<h3 id="2）、MHA软件安装"><a href="#2）、MHA软件安装" class="headerlink" title="2）、MHA软件安装"></a>2）、MHA软件安装</h3><p>Centos7.6必须安装0.57版本，所有服务器上必须先安装node组件，最后在MHA-Manager节点上安装manager组件，因为manager依赖node组件</p>
<h3 id="3）、配置ssh无密码认证"><a href="#3）、配置ssh无密码认证" class="headerlink" title="3）、配置ssh无密码认证"></a>3）、配置ssh无密码认证</h3><h3 id="4）、配置虚拟IP"><a href="#4）、配置虚拟IP" class="headerlink" title="4）、配置虚拟IP"></a>4）、配置虚拟IP</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[root@Manager ~]# vi /usr/local/bin/master_ip_failover</span><br><span class="line">#!/usr/bin/env perl</span><br><span class="line">use strict;</span><br><span class="line">use warnings FATAL =&gt; &#x27;all&#x27;;</span><br><span class="line"></span><br><span class="line">use Getopt::Long;</span><br><span class="line"></span><br><span class="line">my (</span><br><span class="line">$command, $ssh_user, $orig_master_host, $orig_master_ip,</span><br><span class="line">$orig_master_port, $new_master_host, $new_master_ip, $new_master_port</span><br><span class="line">);</span><br><span class="line">#############################添加内容部分#########################################</span><br><span class="line">my $vip = &#x27;192.168.73.200&#x27;;</span><br><span class="line">my $brdc = &#x27;192.168.73.255&#x27;;</span><br><span class="line">my $ifdev = &#x27;ens33&#x27;;</span><br><span class="line">my $key = &#x27;1&#x27;;</span><br><span class="line">my $ssh_start_vip = &quot;/sbin/ifconfig ens33:$key $vip&quot;;</span><br><span class="line">my $ssh_stop_vip = &quot;/sbin/ifconfig ens33:$key down&quot;;</span><br><span class="line">my $exit_code = 0;</span><br><span class="line">#my $ssh_start_vip = &quot;/usr/sbin/ip addr add $vip/24 brd $brdc dev $ifdev label $ifdev:$key;/usr/sbin/arping -q -A -c 1 -I $ifdev $vip;iptables -F;&quot;;</span><br><span class="line">#my $ssh_stop_vip = &quot;/usr/sbin/ip addr del $vip/24 dev $ifdev label $ifdev:$key&quot;;</span><br><span class="line">##################################################################################</span><br><span class="line">GetOptions(</span><br><span class="line">&#x27;command=s&#x27; =&gt; \$command,</span><br><span class="line">&#x27;ssh_user=s&#x27; =&gt; \$ssh_user,</span><br><span class="line">&#x27;orig_master_host=s&#x27; =&gt; \$orig_master_host,</span><br><span class="line">&#x27;orig_master_ip=s&#x27; =&gt; \$orig_master_ip,</span><br><span class="line">&#x27;orig_master_port=i&#x27; =&gt; \$orig_master_port,</span><br><span class="line">&#x27;new_master_host=s&#x27; =&gt; \$new_master_host,</span><br><span class="line">&#x27;new_master_ip=s&#x27; =&gt; \$new_master_ip,</span><br><span class="line">&#x27;new_master_port=i&#x27; =&gt; \$new_master_port,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">exit &amp;main();</span><br><span class="line"></span><br><span class="line">sub main &#123;</span><br><span class="line"></span><br><span class="line">print &quot;\n\nIN SCRIPT TEST====$ssh_stop_vip==$ssh_start_vip===\n\n&quot;;</span><br><span class="line"></span><br><span class="line">if ( $command eq &quot;stop&quot; || $command eq &quot;stopssh&quot; ) &#123;</span><br><span class="line"></span><br><span class="line">my $exit_code = 1;</span><br><span class="line">eval &#123;</span><br><span class="line">print &quot;Disabling the VIP on old master: $orig_master_host \n&quot;;</span><br><span class="line">&amp;stop_vip();</span><br><span class="line">$exit_code = 0;</span><br><span class="line">&#125;;</span><br><span class="line">if ($@) &#123;</span><br><span class="line">warn &quot;Got Error: $@\n&quot;;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">elsif ( $command eq &quot;start&quot; ) &#123;</span><br><span class="line"></span><br><span class="line">my $exit_code = 10;</span><br><span class="line">eval &#123;</span><br><span class="line">print &quot;Enabling the VIP - $vip on the new master - $new_master_host \n&quot;;</span><br><span class="line">&amp;start_vip();</span><br><span class="line">$exit_code = 0;</span><br><span class="line">&#125;;</span><br><span class="line">if ($@) &#123;</span><br><span class="line">warn $@;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">elsif ( $command eq &quot;status&quot; ) &#123;</span><br><span class="line">print &quot;Checking the Status of the script.. OK \n&quot;;</span><br><span class="line">exit 0;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">&amp;usage();</span><br><span class="line">exit 1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sub start_vip() &#123;</span><br><span class="line">`ssh $ssh_user\@$new_master_host \&quot; $ssh_start_vip \&quot;`;</span><br><span class="line">&#125;</span><br><span class="line"># A simple system call that disable the VIP on the old_master</span><br><span class="line">sub stop_vip() &#123;</span><br><span class="line">`ssh $ssh_user\@$orig_master_host \&quot; $ssh_stop_vip \&quot;`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub usage &#123;</span><br><span class="line">print</span><br><span class="line">&quot;Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5）、配置文件解析"><a href="#5）、配置文件解析" class="headerlink" title="5）、配置文件解析"></a>5）、配置文件解析</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[server default]</span><br><span class="line">manager_log=/var/log/masterha/app1/manager.log #manager日志</span><br><span class="line">manager_workdir=/var/log/masterha/app1 #manager工作目录</span><br><span class="line">master_binlog_dir=/usr/local/mysql/data #master保存binlog的位置</span><br><span class="line">master_ip_failover_script=/usr/local/bin/master_ip_failover #设置自动failover时候的切换脚本</span><br><span class="line">master_ip_online_change_script=/usr/local/bin/master_ip_online_change #设置手动切换时的切换脚本</span><br><span class="line">password=manager #设置mysql中root用户的密码，这个密码是前面创建监控用户的密码</span><br><span class="line">ping_interval=1 #设置监控主库，发送ping包的时间间隔，默认是3秒，尝试三次没有回应的时候自动进行failover</span><br><span class="line">remote_workdir=/tmp #设置远端mysql在发生切换时binlog的保存位置</span><br><span class="line">repl_password=abc123 #设置复制用户的密码</span><br><span class="line">repl_user=myslave #设置复制用户的账户</span><br><span class="line">report_script=/usr/local/send_report #设置发生切换后发送的报警的脚本</span><br><span class="line">secondary_check_script=/usr/local/bin/masterha_secondary_check -s 14.0.0.30 -s 14.0.0.40</span><br><span class="line">shutdown_script=&quot;&quot; #设置故障发生后关闭故障主机脚本（该脚本的主要作用是关闭主机防止发生脑裂）</span><br><span class="line">ssh_user=root #设置ssh的登录用户名</span><br><span class="line">user=mha #设置监控用户</span><br></pre></td></tr></table></figure>



<h3 id="6）、ssh无密码认证测试"><a href="#6）、ssh无密码认证测试" class="headerlink" title="6）、ssh无密码认证测试"></a>6）、ssh无密码认证测试</h3><h3 id="7）、MHA健康检查"><a href="#7）、MHA健康检查" class="headerlink" title="7）、MHA健康检查"></a>7）、MHA健康检查</h3><h3 id="8）、在MHA的master节点开启虚拟IP"><a href="#8）、在MHA的master节点开启虚拟IP" class="headerlink" title="8）、在MHA的master节点开启虚拟IP"></a>8）、在MHA的master节点开启虚拟IP</h3><h1 id="九、SQL高级语句"><a href="#九、SQL高级语句" class="headerlink" title="九、SQL高级语句"></a>九、SQL高级语句</h1><h2 id="1、按关键字排序（order-by）"><a href="#1、按关键字排序（order-by）" class="headerlink" title="1、按关键字排序（order by）"></a>1、按关键字排序（order by）</h2><p> 1、使用order by语句来实现排序<br>2、排序可针对一个或多个字段<br>3、<strong>ASC：升序</strong>，默认排序方式<br>4、<strong>DESC：降序</strong><br>5、order by的语法结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段1，字段2 from 表名 order by 字段1 desc|asc，字段2 desc|asc；</span><br></pre></td></tr></table></figure>

<h2 id="2、对结果进行分组"><a href="#2、对结果进行分组" class="headerlink" title="2、对结果进行分组"></a>2、对结果进行分组</h2><p> 1、使用group by语句来实现分组<br>2、通常结合聚合函数一起使用<br>3、可以按一个或多个字段对结果进行分组<br>4、group by的语法结构 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(name),score from a where score &gt; 80 group by score;</span><br></pre></td></tr></table></figure>



<h2 id="3、限制结果条目"><a href="#3、限制结果条目" class="headerlink" title="3、限制结果条目"></a>3、限制结果条目</h2><p> 1、只返回select查询结果的第一行或前几行<br>2、使用limit语句限制条目<br>3、limit语法结构</p>
<p>offset：位置偏移量，从0开始<br>number：返回记录行的最大数目 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段1，字段2 from 表名 limit [offset,] number；</span><br></pre></td></tr></table></figure>

<p>offset：位置偏移量，从0开始<br>number：返回记录行的最大数目 </p>
<p>例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from a limit 2,3;  ##从索引2开始，显示3行</span><br></pre></td></tr></table></figure>



<h2 id="4、设置别名"><a href="#4、设置别名" class="headerlink" title="4、设置别名"></a>4、设置别名</h2><p> 1、使用as语句设置别名，关键字as可省略<br>2、设置别名时，保证不能与库中其他表或字段名称冲突<br>3、别名的语法结构<br>字段别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段 as 别名 from 表名；</span><br></pre></td></tr></table></figure>

<p>表的别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段 from 表名 as 别名；</span><br></pre></td></tr></table></figure>

<h2 id="5、通配符"><a href="#5、通配符" class="headerlink" title="5、通配符"></a>5、通配符</h2><p> 1、用于替换字符串中的部分字符<br>2、通常配合like一起使用，并协同where完成查询<br>3、常用通配符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%  表示零个、一个或多个即任意字符</span><br><span class="line">_  表示单个字符 </span><br></pre></td></tr></table></figure>



<h2 id="6、子查询"><a href="#6、子查询" class="headerlink" title="6、子查询"></a>6、子查询</h2><p> 1、也称作内查询或者嵌套查询<br>2、先于主查询被执行，其结果将作为外层主查询的条件<br>3、在增删改查中都可以使用子查询<br>4、支持多层嵌套<br>5、in语句用来判断某个值是否在给定的结果集中 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例：</span><br><span class="line">select id,name from a where id in(1,2);</span><br><span class="line"></span><br><span class="line">select * from a where id in(select id from a where score&gt;80);</span><br></pre></td></tr></table></figure>



<h2 id="7、null值"><a href="#7、null值" class="headerlink" title="7、null值"></a>7、null值</h2><p> null：真空（什么都没有）<br>‘’：空气（还有空气）<br>1、表示缺失的值<br>2、与数字0或者空白（spaces）是不同的<br>3、使用is null或is not null进行判断<br>4、null值和空值（’’）的区别<br>空值长度为0，不占空间；null值的长度为null，占用空间<br>is null无法判断空值<br>空值使用“&#x3D;”或者“&lt;&gt;”来处理<br>count()计算时，null会忽略，空值会加入计算 </p>
<h2 id="8、正则表达式"><a href="#8、正则表达式" class="headerlink" title="8、正则表达式"></a>8、正则表达式</h2><table>
<thead>
<tr>
<th>^</th>
<th>匹配文本的开始字符</th>
</tr>
</thead>
<tbody><tr>
<td>$</td>
<td>匹配文本的结束字符</td>
</tr>
<tr>
<td>.</td>
<td>匹配任何单个字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配前面的字符零次或多次</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的字符一次或多次</td>
</tr>
<tr>
<td>字符串</td>
<td>匹配包含指定的字符串</td>
</tr>
<tr>
<td>p1lp2</td>
<td>匹配p1或p2</td>
</tr>
<tr>
<td>[…]</td>
<td>匹配字符集合中任一字符</td>
</tr>
<tr>
<td>[^…]</td>
<td>匹配不在括号中的任一字符</td>
</tr>
<tr>
<td>{n}</td>
<td>匹配前面的字符串n次</td>
</tr>
<tr>
<td>{n，m}</td>
<td>匹配前面的字符串至少n次，之多m次</td>
</tr>
</tbody></table>
<h2 id="9、运算符"><a href="#9、运算符" class="headerlink" title="9、运算符"></a>9、运算符</h2><p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210118145011.png" alt="1607585977880"></p>
<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210118145013.png" alt="1607586883956"></p>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210118145015.png" alt="1607587043020"></p>
<h4 id="（1）逻辑非"><a href="#（1）逻辑非" class="headerlink" title="（1）逻辑非"></a>（1）逻辑非</h4><p>逻辑非将跟在它后面的逻辑测试取反，把真变为假，把假变为真。<br>如果 NOT 后面的操作数为 0 时，所得值为 1；如果操作数为非 0 时，所得值为 0；如果操作数为 NULL 时，所得值为 NULL。<br>注意：非0值都是1<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104010.png" alt="在这里插入图片描述"></p>
<h4 id="（2）逻辑与"><a href="#（2）逻辑与" class="headerlink" title="（2）逻辑与"></a>（2）逻辑与</h4><p>如果所有值都是真返回 1，否则返回 0。<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104018.png" alt="在这里插入图片描述"></p>
<h4 id="（3）逻辑或（最好用or）"><a href="#（3）逻辑或（最好用or）" class="headerlink" title="（3）逻辑或（最好用or）"></a>（3）逻辑或（最好用or）</h4><p>逻辑或表示包含的操作数，任意一个为非零值并且不是 NULL 值时，返回 1，否则返回0。<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104028.png" alt="在这里插入图片描述"></p>
<h4 id="（4）逻辑异或"><a href="#（4）逻辑异或" class="headerlink" title="（4）逻辑异或"></a>（4）逻辑异或</h4><p>两个非 NULL 值的操作数，如果两者都是 0 或者都是非 0，则返回 0；如果一个为 0， 另一个为非 0，则返回结果为 1；<br>当任意一个值为 NULL 时，返回值为 NULL。<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104033.png" alt="在这里插入图片描述"><br>运算总结：<br>and运算，只要碰到0就是0，（非0和null是null）<br>or运算，只要碰到非0值就是1，（0和null是null）<br>异或运算，只要碰到null都是null</p>
<h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><p>位运算符实际上是对二进制数进行计算的运算符。<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104038.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104044.png" alt="在这里插入图片描述"><br>位运算方法：<br>按位与运算<br>10–》1010<br>15–》1111<br>1010 –》10<br>按位与运算（&amp;），是对应的二进制位都是 1 的，它们的运算结果为 1，否则为 0</p>
<p>按位或运算<br>10–》1010<br>15–》1111<br>1111–》15<br>按位或运算（|），是对应的二进制位只要是 1 的，它们的运算结果就为 1，否则为 0</p>
<p>按位异或运算<br>10–》1010<br>15–》1111<br>0101–》5<br>按位异或运算（^），是对应的二进制位不相同时，运算结果 1，否则为 0</p>
<p>按位取反运算<br>1–》0001<br><del>1–》1110<br>5–》0101<br>0100–》4<br>按位取反（</del>），是对应的二进制数逐位反转，即 1 取反后变为 0, 0 取反后变为 1<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104049.png" alt="在这里插入图片描述"><br>按位左移运算<br>1&lt;&lt;2<br>1–》0001<br>按位左移2位，空缺处补0<br>0100–》4</p>
<p>10&lt;&lt;3<br>10–》1010<br>按位左移3位，空缺处补0<br>1010000–》80<br>按位右移运算<br>10&gt;&gt;2<br>10–》1010<br>按位右移2位，多余的位数直接删除<br>0010–》2</p>
<p>15&gt;&gt;2<br>15–》1111<br>按位右移2位，多余的位数直接删除<br>0011–》3<br>常用的运算符优先级<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104116.png" alt="在这里插入图片描述"></p>
<h2 id="10、连接查询"><a href="#10、连接查询" class="headerlink" title="10、连接查询"></a>10、连接查询</h2><p>通常都是将来自两个或多个表的行结合起来，基于这些表之间的共同字段，进行数据的拼接。<br>要先确定一个主表作为结果集，然后将其他表的行有选择性的连接到选定的主表结果集上。</p>
<p>使用较多的连接查询包括：内连接、左连接和右连接</p>
<h3 id="1、内连接"><a href="#1、内连接" class="headerlink" title="1、内连接"></a>1、内连接</h3><p>在from子句中使用关键字 inner join 来连接多张表，并使用 on子句设置连接条件。<br><strong>mysql&gt; select info.name,hob.hobbyname from info inner join hob on info.hobby&#x3D;hob.id;</strong><br>内连接是系统默认的表连接，所以在 FROM 子句后可以省略 INNER 关键字，只使用关键字 JOIN。同时有多个表时，也可以连续使用 INNER JOIN 来实现多表的内连接，不过为了更好的性能，建议最好不要超过三个表。</p>
<h3 id="2、外连接"><a href="#2、外连接" class="headerlink" title="2、外连接"></a>2、外连接</h3><p>左连接，主表在左边，主表内容会全部显示出来，在从表中没匹配到的以NULL显示出来<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104122.png" alt="在这里插入图片描述"></p>
<p>右连接，主表在右边，主表内容会全部显示出来，在从表中没匹配到的以NULL显示出来<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104127.png" alt="在这里插入图片描述"></p>
<h1 id="十、MySQL函数"><a href="#十、MySQL函数" class="headerlink" title="十、MySQL函数"></a>十、MySQL函数</h1><h2 id="数据库函数"><a href="#数据库函数" class="headerlink" title="数据库函数"></a>数据库函数</h2><p>常用的函数分类<br>1、数学函数<br>2、聚合函数<br>3、字符串函数<br>4、日期时间函数</p>
<h2 id="1、常用的数学函数"><a href="#1、常用的数学函数" class="headerlink" title="1、常用的数学函数"></a>1、常用的数学函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">abs(x)：返回x的绝对值</span><br><span class="line">rand()：返回0到1的随机数（0-0.9999…，1是取不到的）</span><br><span class="line">mod(x,y)：返回x除以y以后的余数</span><br><span class="line">power(x,y)：返回x的y次方</span><br><span class="line">round(x)：返回离x最近的整数（四舍五入，只看小数点后第一位）</span><br><span class="line">round(x,y)：保留x的y位小数四舍五入后的值</span><br><span class="line">sqrt(x)：返回x的平方根</span><br><span class="line">truncate(x,y)：返回数字x截断为y位小数的值</span><br><span class="line">ceil(x)：返回大于或等于x的最小整数（向上取整数）</span><br><span class="line">floor(x)：返回小于或等于x的最大整数（向下取整数）</span><br><span class="line">greatest(x1,x2…)：返回集合中最大的值</span><br><span class="line">least(x1,x2…)：返回集合中最小的值</span><br></pre></td></tr></table></figure>



<p>abs(x)：返回x的绝对值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104131.png" alt="在这里插入图片描述"></p>
<p>rand()：返回0到1的随机数（0-0.9999…，1是取不到的）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104136.png" alt="在这里插入图片描述"></p>
<p>mod(x,y)：返回x除以y以后的余数</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104140.png" alt="在这里插入图片描述"></p>
<p>power(x,y)：返回x的y次方</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104144.png" alt="在这里插入图片描述"></p>
<p>round(x)：返回离x最近的整数（四舍五入，只看小数点后第一位）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104148.png" alt="在这里插入图片描述"></p>
<p>round(x,y)：保留x的y位小数四舍五入后的值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104151.png" alt="在这里插入图片描述"></p>
<p>sqrt(x)：返回x的平方根</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104154.png" alt="在这里插入图片描述"></p>
<p>truncate(x,y)：返回数字x截断为y位小数的值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104158.png" alt="在这里插入图片描述"></p>
<p>ceil(x)：返回大于或等于x的最小整数（向上取整数）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104201.png" alt="在这里插入图片描述"></p>
<p>floor(x)：返回小于或等于x的最大整数（向下取整数）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104204.png" alt="在这里插入图片描述"></p>
<p>greatest(x1,x2…)：返回集合中最大的值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104207.png" alt="在这里插入图片描述"></p>
<p>least(x1,x2…)：返回集合中最小的值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104212.png" alt="在这里插入图片描述"></p>
<h2 id="2、聚合函数"><a href="#2、聚合函数" class="headerlink" title="2、聚合函数"></a>2、聚合函数</h2><p>●对表中数据记录进行集中概括而设计的一类函数<br>●常用的聚合函数（只会产生一个值）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">avg(字段名) 返回指定字段的平均值</span><br><span class="line">count(字段名) 返回指定字段中非NULL值的个数 </span><br><span class="line">min(字段名) 返回指定字段的最小值</span><br><span class="line">max(字段名) 返回指定字段的最大值</span><br><span class="line">sum(字段名) 返回指定字段的所有值之和</span><br></pre></td></tr></table></figure>



<p>avg(字段名) 返回指定字段的平均值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104217.png" alt="在这里插入图片描述"></p>
<p>count(字段名) 返回指定字段中非NULL值的个数 </p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104221.png" alt="在这里插入图片描述"></p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104224.png" alt="在这里插入图片描述"></p>
<p>min(字段名) 返回指定字段的最小值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104230.png" alt="在这里插入图片描述"></p>
<p>max(字段名) 返回指定字段的最大值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104234.png" alt="在这里插入图片描述"></p>
<p>sum(字段名) 返回指定字段的所有值之和</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104237.png" alt="在这里插入图片描述"></p>
<h2 id="3、字符串函数"><a href="#3、字符串函数" class="headerlink" title="3、字符串函数"></a>3、字符串函数</h2><p>●常用的字符串函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">length(x)：返回字符串x的长度（空格也算）</span><br><span class="line">trim()：返回去除指定格式的值（只能去除前后的空格）</span><br><span class="line">concat(x,y)：将提供的参数x和y拼接成一个字符串</span><br><span class="line">upper(x)：将字符串x的所有字母变成大写字母</span><br><span class="line">lower(x)：将字符串x的所有字母变成小写字母</span><br><span class="line">left(x,y)：返回字符串x的前y个字符</span><br><span class="line">right(x,y)：返回字符串x的后y个字符</span><br><span class="line">repeat(x,y)：将字符串x重复y次</span><br><span class="line">space(x)：返回x个空格（结合concat使用）</span><br><span class="line">replace(x,y,z)：将字符串z替代字符串x中的字符串y</span><br><span class="line">strcmp(x,y)：比较x和y，返回的值可以为-1 &lt;，0 =，1 &gt;</span><br><span class="line">substring(x,y,z)：获取从字符串x中的第y个位置开始长度为z的字符串</span><br><span class="line">reverse(x)：将字符串x反转</span><br></pre></td></tr></table></figure>



<p>length(x)：返回字符串x的长度（空格也算）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104241.png" alt="在这里插入图片描述"></p>
<p>trim()：返回去除指定格式的值（只能去除前后的空格）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104245.png" alt="在这里插入图片描述"></p>
<p>concat(x,y)：将提供的参数x和y拼接成一个字符串</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104249.png" alt="在这里插入图片描述"></p>
<p>upper(x)：将字符串x的所有字母变成大写字母</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104253.png" alt="在这里插入图片描述"></p>
<p>lower(x)：将字符串x的所有字母变成小写字母</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104256.png" alt="在这里插入图片描述"></p>
<p>left(x,y)：返回字符串x的前y个字符</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104259.png" alt="在这里插入图片描述"></p>
<p>right(x,y)：返回字符串x的后y个字符</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104303.png" alt="在这里插入图片描述"></p>
<p>repeat(x,y)：将字符串x重复y次</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104306.png" alt="在这里插入图片描述"></p>
<p>space(x)：返回x个空格（结合concat使用）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104310.png" alt="在这里插入图片描述"></p>
<p>replace(x,y,z)：将字符串z替代字符串x中的字符串y</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104315.png" alt="在这里插入图片描述"></p>
<p>strcmp(x,y)：比较x和y，返回的值可以为-1 &lt;，0 &#x3D;，1 &gt;</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104319.png" alt="在这里插入图片描述"></p>
<p>substring(x,y,z)：获取从字符串x中的第y个位置开始长度为z的字符串</p>
<p> 格式：substring(完整字符串,起始位置,长度)； ##起始位置从1开始<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104323.png" alt="在这里插入图片描述"></p>
<p>reverse(x)：将字符串x反转</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104327.png" alt="在这里插入图片描述"></p>
<h2 id="4、日期时间函数"><a href="#4、日期时间函数" class="headerlink" title="4、日期时间函数"></a>4、日期时间函数</h2><p>●常用的日期时间函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curdate()：返回当前时间的年月日</span><br><span class="line">curtime()：返回当前时间的时分秒</span><br><span class="line">now()：返回当前时间的日期和时间</span><br><span class="line">month(x)：返回日期x中的月份值</span><br><span class="line">hour(x)：返回x中的小时值</span><br><span class="line">minute(x)：返回x中的分钟值</span><br><span class="line">second(x)：返回x中的秒钟值</span><br><span class="line">dayofweek(x)：返回x是星期几，1星期日，2星期一，3星期二…</span><br><span class="line">dayofmonth(x)：计算日期x是本月的第几天</span><br><span class="line">dayofyear(x)：计算日期x是本年的第几天</span><br></pre></td></tr></table></figure>

<p>curdate()：返回当前时间的年月日</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104332.png" alt="在这里插入图片描述"></p>
<p>curtime()：返回当前时间的时分秒</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104335.png" alt="在这里插入图片描述"></p>
<p>now()：返回当前时间的日期和时间</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104339.png" alt="在这里插入图片描述"></p>
<p>month(x)：返回日期x中的月份值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104342.png" alt="在这里插入图片描述"></p>
<p>hour(x)：返回x中的小时值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104347.png" alt="在这里插入图片描述"></p>
<p>minute(x)：返回x中的分钟值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104350.png" alt="在这里插入图片描述"></p>
<p>second(x)：返回x中的秒钟值</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104353.png" alt="在这里插入图片描述"></p>
<p>dayofweek(x)：返回x是星期几，1星期日，2星期一，3星期二…</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104356.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104359.png" alt="在这里插入图片描述"></p>
<p>dayofmonth(x)：计算日期x是本月的第几天</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104402.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104405.png" alt="在这里插入图片描述"></p>
<p>dayofyear(x)：计算日期x是本年的第几天</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104409.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104412.png" alt="在这里插入图片描述"></p>
<h1 id="十一、MySQL存储过程"><a href="#十一、MySQL存储过程" class="headerlink" title="十一、MySQL存储过程"></a>十一、MySQL存储过程</h1><h2 id="1、存储过程简介"><a href="#1、存储过程简介" class="headerlink" title="1、存储过程简介"></a>1、存储过程简介</h2><p>1、从 5.0 版本才开始支持<br>2、是一组为了完成特定功能的SQL语句集合（封装）<br>3、比传统SQL速度更快、执行效率更高<br>4、存储过程的优点<br>执行一次后，会将生成的二进制代码驻留缓冲区（便于下次执行），提高执行效率<br>SQL语句加上控制语句的集合，灵活性高<br>在服务器端存储，客户端调用时，降低网络负载<br>可多次重复被调用，可随时修改，不影响客户端调用<br>可完成所有的数据库操作，也可控制数据库的信息访问权限<br>5、为什么要用存储过程？<br>1.减轻网络负载；2.增加安全性</p>
<p>传统SQL访问MySQL服务端过程：</p>
<p><img src="C:/%E6%9C%89%E9%81%93/%E7%AC%94%E8%AE%B0/weixinobU7Vjr77MsBJ6yQf29GVWik52DI/713d719be6ee4ed9857fc02c1efabc16/clipboard.png" alt="img"></p>
<p>使用存储过程访问MySQL服务端：</p>
<p><img src="C:/%E6%9C%89%E9%81%93/%E7%AC%94%E8%AE%B0/weixinobU7Vjr77MsBJ6yQf29GVWik52DI/4a6f1d5a1d82492aaef0fbc523945aa0/clipboard.png" alt="img"></p>
<h2 id="2、创建存储过程"><a href="#2、创建存储过程" class="headerlink" title="2、创建存储过程"></a>2、创建存储过程</h2><p>1、使用create procedure语句创建存储过程<br>2、参数分为<br>输入参数：in<br>输出参数：out<br>输入&#x2F;输出参数：inout<br>3、存储过程的主体部分，被称为过程体；以begin开始，以end$$结束<br>4、具体格式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure 存储过程名（in 参数名 参数类型）</span><br><span class="line">begin</span><br><span class="line">#定义变量</span><br><span class="line">declare 变量名 变量类型</span><br><span class="line">#变量赋值</span><br><span class="line">set 变量名 = 值</span><br><span class="line">  sql 语句1；</span><br><span class="line">  sql 语句2；</span><br><span class="line">  ...</span><br><span class="line">end$$</span><br><span class="line">delimiter ；（有空格）</span><br><span class="line">123456789101112</span><br></pre></td></tr></table></figure>



<p>示例：</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104421.png" alt="在这里插入图片描述"></p>
<h2 id="3、调用存储过程"><a href="#3、调用存储过程" class="headerlink" title="3、调用存储过程"></a>3、调用存储过程</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call 存储过程名(实际参数);</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104425.png" alt="在这里插入图片描述"></p>
<h2 id="4、查询存储过程"><a href="#4、查询存储过程" class="headerlink" title="4、查询存储过程"></a>4、查询存储过程</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show procedure status where db=&#x27;数据库&#x27;；</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104429.png" alt="在这里插入图片描述"></p>
<h2 id="5、修改存储过程"><a href="#5、修改存储过程" class="headerlink" title="5、修改存储过程"></a>5、修改存储过程</h2><p>存储过程的修改分为特征的修改和业务内容的修改。<br>特征的修改语法结构如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter procedure 存储过程名 [ <span class="tag">&lt;<span class="name">特征</span>&gt;</span> … ]</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>存储过程内容的修改方法是通过删除原有存储过程，之后再以相同的名称创建新的存储过程。</p>
<h2 id="6、删除存储过程"><a href="#6、删除存储过程" class="headerlink" title="6、删除存储过程"></a>6、删除存储过程</h2><p>删除存储过程的语法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop &#123;procedure|function|if exits&#125; <span class="tag">&lt;<span class="name">过程名</span>&gt;</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104433.png" alt="在这里插入图片描述"></p>
<h2 id="7、传递参数过程示例："><a href="#7、传递参数过程示例：" class="headerlink" title="7、传递参数过程示例："></a>7、传递参数过程示例：</h2><p>1、<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104436.png" alt="在这里插入图片描述"><br>2、<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104440.png" alt="在这里插入图片描述"><br>总结：in和inout参数会将全局变量的值传入存储过程中，而out参数不会将全局变量的值传入存储过程中。在存储过程使用中，参数值in，out，inout都会发生改变。</p>
<p>3、<br><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104443.png" alt="在这里插入图片描述"><br>总结：调用完存储过程后，发现in参数不会对全局变量的值引起变化，而out和inout参数调用完存储过程后，会对全局变量的值产生变化，会将存储过程引用后的值赋值给全局变量。</p>
<p>in参数赋值类型可以是变量还有定值，而out和inout参数赋值类型必须为变量。</p>
<h1 id="十二、死锁＋慢查询"><a href="#十二、死锁＋慢查询" class="headerlink" title="十二、死锁＋慢查询"></a>十二、死锁＋慢查询</h1><p>MySQL引擎默认的锁级别：</p>
<p>MyISAM和MEMORY采用表级锁(table-level locking)。 </p>
<p>BDB采用页面锁(page-level locking)或表级锁，默认为页面锁。 </p>
<p>InnoDB支持行级锁(row-level locking)和表级锁，默认为行级锁。</p>
<p><strong>Innodb引擎中的行锁与表锁</strong>    </p>
<p>在Innodb引擎中既支持行锁也支持表锁，那么什么时候会锁住整张表，什么时候或只锁住一行呢？ </p>
<p>InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，Oracle者是通过在数据块中对相应数据行加锁来实现的。</p>
<p>InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！ </p>
<p>在实际应用中，要特别注意InnoDB行锁的这一特性，不然的话，可能导致大量的锁冲突，从而影响并发性能。 </p>
<p>行级锁都是基于索引的，如果一条SQL语句用不到索引是不会使用行级锁的，会使用表级锁。</p>
<p>行级锁的缺点是：如果并发请求大量的锁资源，所以速度慢，内存消耗大。</p>
<h3 id="1、行级锁与死锁"><a href="#1、行级锁与死锁" class="headerlink" title="1、行级锁与死锁"></a>1、行级锁与死锁</h3><p>　　MyISAM中是不会产生死锁的，因为MyISAM总是一次性获得所需的全部锁，要么全部满足，要么全部等待。而在InnoDB中，锁是逐步获得的，就造成了死锁的可能。</p>
<p>　　在MySQL中，行级锁并不是直接锁记录，而是锁索引。索引分为主键索引和非主键索引两种，如果一条sql语句操作了主键索引，MySQL就会锁定这条主键索引；如果一条语句操作了非主键索引，MySQL会先锁定该非主键索引，再锁定相关的主键索引。 在UPDATE、DELETE操作时，MySQL不仅锁定WHERE条件扫描过的所有索引记录，而且会锁定相邻的键值，即所谓的next-key locking。</p>
<p>　　当两个事务同时执行，一个锁住了主键索引，在等待其他相关索引。另一个锁定了非主键索引，在等待主键索引。这样就会发生死锁。</p>
<p>　　发生死锁后，InnoDB一般都可以检测到，并使一个事务释放锁回退，另一个获取锁完成事务。</p>
<p><strong>如何怎么避免死锁？</strong></p>
<p>1）以固定的顺序访问表和行。</p>
<p>分为两种情景：</p>
<p>对于不同事务访问不同的表，尽量做到访问表的顺序一致；</p>
<p>对于不同事务访问相同的表，尽量对记录的id做好排序，执行顺序一致；</p>
<p>2）大事务拆小。大事务更倾向于死锁，如果业务允许，将大事务拆小。</p>
<p>3）在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁概率。</p>
<p>4）降低隔离级别。如果业务允许，将隔离级别调低也是较好的选择，比如将隔离级别从RR调整为RC，可以避免掉很多因为gap锁造成的死锁。</p>
<p>5）为表添加合理的索引。可以看到如果不走索引将会为表的每一行记录添加上锁，死锁的概率大大增大。</p>
<p><strong>怎么解决死锁？</strong></p>
<p>第一步，查出已锁的进程</p>
<p>查看正在锁的事务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS;  </span><br></pre></td></tr></table></figure>

<p>查看等待锁的事务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS;  </span><br></pre></td></tr></table></figure>

<p>INNODB_TRX表主要是包含了正在InnoDB引擎中执行的所有事务的信息，包括waiting for a lock和running的事务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.innodb_trx</span><br></pre></td></tr></table></figure>

<p>第二步，kill进程</p>
<h3 id="2、慢查询："><a href="#2、慢查询：" class="headerlink" title="2、慢查询："></a>2、慢查询：</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42030357/article/details/104105932">https://blog.csdn.net/weixin_42030357/article/details/104105932</a></p>
<p><strong>进行SQL优化的手段也主要是修改SQL写法，或者新增索引。</strong></p>
<p>  <strong>（1）数据库中设置SQL慢查询</strong></p>
<p>   一、第一步.开启mysql慢查询</p>
<p>  方式一：</p>
<p>​    修改配置文件在 my.cnf增加几行: 主要是慢查询的定义时间（超过2秒就是慢查询），以及慢查询log日志记录（ slow_query_log）</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127111100.png" alt="在这里插入图片描述"></p>
<p>   方法二：通过MySQL数据库开启慢查询:</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127111111.png" alt="在这里插入图片描述"></p>
<p><strong>（2）分析慢查询日志</strong>    </p>
<p>​    直接分析mysql慢查询日志 ,利用explain关键字可以模拟优化器执行SQL查询语句，来分析sql慢查询语句</p>
<p> 例如：执行<code>EXPLAIN SELECT * FROM res_user ORDER BYmodifiedtime LIMIT 0,1000</code>得到如下结果： 显示结果分析：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">table</span> <span class="operator">|</span>  type <span class="operator">|</span> possible_keys <span class="operator">|</span> key <span class="operator">|</span>key_len  <span class="operator">|</span> <span class="keyword">ref</span> <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> Extra  EXPLAIN列的解释：           </span><br><span class="line"></span><br><span class="line"><span class="keyword">table</span>                 显示这一行的数据是关于哪张表的           </span><br><span class="line"></span><br><span class="line">type                  这是重要的列，显示连接使用了何种类型。从最好到最差的连接类型为const、eq_reg、<span class="keyword">ref</span>、<span class="keyword">range</span>、indexhe和<span class="keyword">ALL</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">rows</span>                显示需要扫描行数</span><br><span class="line"></span><br><span class="line">key                   使用的索引</span><br></pre></td></tr></table></figure>

<p><strong>（3）常见的慢查询优化</strong></p>
<p> <strong>①、索引没起作用的情况</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a、使用LIKE关键字的查询语句</span><br><span class="line">在使用LIKE关键字进行查询的查询语句中，如果匹配字符串的第一个字符为“%”，索引不会起作用。只有“%”不在第一个位置索引才会起作用。</span><br><span class="line"></span><br><span class="line">2、使用多列索引的查询语句</span><br><span class="line">MySQL可以为多个字段创建索引。一个索引最多可以包括16个字段。对于多列索引，只有查询条件使用了这些字段中的第一个字段时，索引才会被使用。</span><br></pre></td></tr></table></figure>

<p> <strong>②、优化数据库结构</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    合理的数据库结构不仅可以使数据库占用更小的磁盘空间，而且能够使查询速度更快。数据库结构的设计，需要考虑数据冗余、查询和更新的速度、字段的数据类型是否合理等多方面的内容。</span><br><span class="line"></span><br><span class="line">a、将字段很多的表分解成多个表</span><br><span class="line">对于字段比较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。因为当一个表的数据量很大时，会由于使用频率低的字段的存在而变慢。</span><br><span class="line"></span><br><span class="line">b、增加中间表</span><br><span class="line">对于需要经常联合查询的表，可以建立中间表以提高查询效率。通过建立中间表，把需要经常联合查询的数据插入到中间表中，然后将原来的联合查询改为对中间表的查询，以此来提高查询效率。</span><br></pre></td></tr></table></figure>



<p> <strong>③、分解关联查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  将一个大的查询分解为多个小查询是很有必要的。</span><br><span class="line"></span><br><span class="line"> 很多高性能的应用都会对关联查询进行分解，就是可以对每一个表进行一次单表查询，然后将查询结果在应用程序中进行关联，很多场景下这样会更高效，例如：    </span><br><span class="line"></span><br><span class="line">SELECT * FROM tag</span><br><span class="line">	JOIN tag_post ON tag_id = tag.id</span><br><span class="line">	JOIN post ON tag_post.post_id = post.id</span><br><span class="line">	WHERE tag.tag = &#x27;mysql&#x27;;      </span><br><span class="line"> </span><br><span class="line">分解为：      </span><br><span class="line">SELECT * FROM tag WHERE tag = &#x27;mysql&#x27;;</span><br><span class="line">SELECT * FROM tag_post WHERE tag_id = 1234;</span><br><span class="line">SELECT * FROM post WHERE post.id in (123,456,567); </span><br></pre></td></tr></table></figure>



<p><strong>④、优化LIMIT分页</strong></p>
<p>   在系统中需要分页的操作通常会使用limit加上偏移量的方法实现，同时加上合适的order by 子句。如果有对应的索引，通常效率会不错，否则MySQL需要做大量的文件排序操作。</p>
<p>   一个非常令人头疼问题就是当偏移量非常大的时候，例如可能是limit 10000,20这样的查询，这是mysql需要查询10020条然后只返回最后20条，前面的10000条记录都将被舍弃，这样的代价很高。</p>
<p>​    优化此类查询的一个最简单的方法是尽可能的使用索引覆盖扫描，而不是查询所有的列。然后根据需要做一次关联操作再返回所需的列。对于偏移量很大的时候这样做的效率会得到很大提升。</p>
<p>   对于下面的查询：</p>
<p>​    select id,title from collect limit 90000,10;</p>
<p>   该语句存在的最大问题在于limit M,N中偏移量M太大（我们暂不考虑筛选字段上要不要添加索引的影响），导致每次查询都要先从整个表中找到满足条件 的前M条记录，之后舍弃这M条记录并从第M+1条记录开始再依次找到N条满足条件的记录。如果表非常大，且筛选字段没有合适的索引，且M特别大那么这样的代价是非常高的。 试想，如我们下一次的查询能从前一次查询结束后标记的位置开始查找，找到满足条件的100条记录，并记下下一次查询应该开始的位置，以便于下一次查询能直接从该位置 开始，这样就不必每次查询都先从整个表中先找到满足条件的前M条记录，舍弃，在从M+1开始再找到100条满足条件的记录了。</p>
<p><strong>方法一：虑筛选字段（title）上加索引</strong></p>
<p>​    title字段加索引 （此效率如何未加验证）</p>
<p><strong>方法二：先查询出主键id值</strong></p>
<p>select id,title from collect where id&gt;&#x3D;(select id from collect order by id limit 90000,1) limit 10;</p>
<p>原理：先查询出90000条数据对应的主键id的值，然后直接通过该id的值直接查询该id后面的数据。</p>
<p><strong>方法三：关延迟联”</strong></p>
<p>如果这个表非常大，那么这个查询可以改写成如下的方式：</p>
<p>   Select news.id, news.description from news inner join (select id from news order by title limit 50000,5) as myNew using(id);</p>
<p>​    这里的<strong>“关延迟联”</strong>将大大提升查询的效率，它让MySQL扫描尽可能少的页面，获取需要的记录后再根据关联列回原表查询需要的所有列。这个技术也可以用在优化关联查询中的limit。</p>
<h1 id="十三、优化范围"><a href="#十三、优化范围" class="headerlink" title="十三、优化范围"></a>十三、优化范围</h1><h2 id="MySQL-服务器硬件和操作系统调节"><a href="#MySQL-服务器硬件和操作系统调节" class="headerlink" title="MySQL 服务器硬件和操作系统调节"></a>MySQL 服务器硬件和操作系统调节</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1. 拥有足够的物理内存来把整个InnoDB文件加载到内存中——在内存中访问文件时的速度要比在硬盘中访问时快的多.</span><br><span class="line">2. 不惜一切代价避免使用Swap交换分区 – 交换时是从硬盘读取的，它的速度很慢.</span><br><span class="line">3. 使用电池供电的RAM（注：RAM即随机存储器）.</span><br><span class="line">4. 使用高级的RAID（注：Redundant Arrays of Inexpensive Disks，即磁盘阵列） – 最好是RAID10或更高.</span><br><span class="line">5. 避免RAID5（注：一种存储性能、数据安全和存储成本兼顾的存储解决方案） – 确保数据库完整性的校验是要付出代价的.</span><br><span class="line">6. 将操作系统和数据分区分开，不仅仅是逻辑上，还包括物理上 – 操作系统的读写操作会影响数据库的性能.</span><br><span class="line">7. 把MySQL临时空间和复制日志与数据放到不同的分区 – 当数据库后台从磁盘进行读写操作时会影响数据库的性能.</span><br><span class="line">8. 更多的磁盘空间等于更快的速度.</span><br><span class="line">9. 更好更快的磁盘.</span><br><span class="line">10. 使用SAS（注： Serial Attached SCSI，即串行连接SCSI）代替SATA（注：SATA，即串口硬盘）.</span><br><span class="line">11. 较小的硬盘 比 较大的硬盘快，尤其是在RAID配置的情况下.</span><br><span class="line">12. 使用电池支持的高速缓存RAID控制器.</span><br><span class="line">13. 避免使用软件磁盘阵列.</span><br><span class="line">14. 考虑为数据分区使用固态IO卡 (不是磁盘驱动器) – 这些卡能够为几乎任何数量的数据支持2GB/s的写入速度.</span><br><span class="line">15. 在[Linux](http://www.ttlsa.com/linux/)中设置swappiness的值为0 – 在数据库服务器中没有理由缓存文件，这是一个服务器或台式机的优势.</span><br><span class="line">16. 如果可以的话，使用 noatime 和 nodirtime 挂载文件系统 – 没有理由更新访问数据库文件的修改时间.</span><br><span class="line">17. 使用 XFS 文件系统 – 一种比ext3更快、更小的文件系统，并且有许多日志选项， 而且ext3 已被证实与MySQL有双缓冲问题.</span><br><span class="line">18. 调整 XFS 文件系统日志和缓冲变量 – 为了最高性能标准.</span><br><span class="line">19. 在 Linux 系统中, 使用 NOOP 或者 DEADLINE IO 定时调度程序 – 同 NOOP 和 DEADLINE定时调度程序相比，这个 CFQ 和 ANTICIPATORY 定时调度程序 显得非常慢.</span><br><span class="line">20. 使用64位的操作系统 – 对于MySQL，会有更大的内存支持和使用.</span><br><span class="line">21. 删除服务器上未使用的安装包和守护进程 – 更少的资源占用.</span><br><span class="line">22. 把使用MySQL的host和你的MySQL host放到一个hosts文件中 – 没有DNS查找.</span><br><span class="line">23. 切勿强制杀死一个MySQL进程 – 你会损坏数据库和正在运行备份的程序.</span><br><span class="line">24. 把服务器贡献给MySQL – 后台进程和其他服务能够缩短数据库占用CPU的时间.</span><br></pre></td></tr></table></figure>



<h2 id="MySQL-配置"><a href="#MySQL-配置" class="headerlink" title="MySQL 配置"></a>MySQL 配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">25. 当写入时，使用 innodb_flush_method=O_DIRECT 来避免双缓冲.</span><br><span class="line">26. 避免使用 O_DIRECT 和 EXT3 文件系统 – 你将序列化所有要写入的.</span><br><span class="line">27. 分配足够的 innodb_buffer_pool_size 来加载整个 InnoDB 文件到内存中– 少从磁盘中读取.</span><br><span class="line">28. 不要将 innodb_log_file_size 参数设置太大， 这样可以更快同时有更多的磁盘空间 – 丢掉多的日志通常是好的，在数据库崩溃后可以降低恢复数据库的时间.</span><br><span class="line">29. 不要混用 innodb_thread_concurrency 和 thread_concurrency 参数– 这2个值是不兼容的.</span><br><span class="line">30. 分配一个极小的数量给 max_connections 参数 – 太多的连接会用尽RAM并锁定MySQL服务.</span><br><span class="line">31. 保持 thread_cache 在一个相对较高的数字，大约 16 – 防止打开连接时缓慢.</span><br><span class="line">32. 使用skip-name-resolve参数 – 去掉 DNS 查找.</span><br><span class="line">33. 如果你的查询都是重复的，并且数据不常常发生变化，那么可以使用查询缓存. 但是如果你的数据经常发生变化，那么使用查询缓存会让你感到失望.</span><br><span class="line">34. 增大temp_table_size值，以防止写入磁盘</span><br><span class="line">35. 增大max_heap_table_size值，以防止写入磁盘</span><br><span class="line">36. 不要把sort_buffer_size值设置的太高，否则的话你的内存将会很快耗尽</span><br><span class="line">37. 根据key_read_requests和key_reads值来决定key_buffer的大小，一般情况下key_read_requests应该比key_reads值高，否则你不能高效的使用key_buffer</span><br><span class="line">38. 将innodb_flush_log_at_trx_commit设置为0将会提高性能，但是如果你要保持默认值（1）的话，那么你就要确保数据的完整性，同时你也要确保复制不会滞后.</span><br><span class="line">39. 你要有一个测试环境，来测试你的配置，并且在不影响正常生产的情况下，可以常常进行重启.</span><br></pre></td></tr></table></figure>



<h2 id="MySQL模式优化"><a href="#MySQL模式优化" class="headerlink" title="MySQL模式优化"></a>MySQL模式优化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">40. 保持你的数据库整理性.</span><br><span class="line">41. 旧数据归档 - 删除多余的行返回或搜索查询.</span><br><span class="line">42. 将您的数据加上索引.</span><br><span class="line">43. 不要过度使用索引，比较与查询.</span><br><span class="line">44. 压缩文字和BLOB数据类型 - 以节省空间和减少磁盘读取次数.</span><br><span class="line">45. UTF 8和UTF16都低于latin1执行效率.</span><br><span class="line">46. 有节制地使用触发器.</span><br><span class="line">47. 冗余数据保持到最低限度 - 不重复不必要的数据.</span><br><span class="line">48. 使用链接表，而不是扩展行.</span><br><span class="line">49. 注意数据类型，在您的真实数据中，尽可能使用最小的一个.</span><br><span class="line">50. 如果其他数据经常被用于查询时，而BLOB / TEXT数据不是，就把BLOB / TEXT数据从其他数据分离出来.</span><br><span class="line">51. 检查和经常优化表.</span><br><span class="line">52. 经常重写InnoDB表优化.</span><br><span class="line">53. 有时，当添加列时删除索引，然后在添加回来索引，这样就会更快.</span><br><span class="line">54. 针对不同的需求，使用不同的存储引擎.</span><br><span class="line">55. 使用归档存储引擎日志表或审计表-这是更有效地写道.</span><br><span class="line">56. 会话数据存储在缓存（[memcache](http://www.ttlsa.com/nosql/memcache/)）的而不是MySQL中 - 缓存允许自动自动填值的，并阻止您创建难以读取和写入到MySQL的时空数据.</span><br><span class="line">57. 存储可变长度的字符串时使用VARCHAR而不是CHAR - 节省空间，因为固定长度的CHAR，而VARCHAR长度不固定（UTF8不受此影响）.</span><br><span class="line">58. 逐步进行模式的变化 - 一个小的变化，可以有巨大的影响.</span><br><span class="line">59. 在开发环境中测试所有模式，反映生产变化.</span><br><span class="line">60. 不要随意更改你的配置文件中的值，它可以产生灾难性的影响.</span><br><span class="line">61. 有时候，在MySQL的configs少即是多.</span><br><span class="line">62. 有疑问时使用一个通用的MySQL配置文件.</span><br></pre></td></tr></table></figure>



<h2 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">63. 使用慢查询日志去发现慢查询.</span><br><span class="line">64. 使用执行计划去判断查询是否正常运行.</span><br><span class="line">65. 总是去测试你的查询看看是否他们运行在最佳状态下 –久而久之性能总会变化.</span><br><span class="line">66. 避免在整个表上使用count(*),它可能锁住整张表.</span><br><span class="line">67. 使查询保持一致以便后续相似的查询可以使用查询缓存.</span><br><span class="line">68. 在适当的情形下使用GROUP BY而不是DISTINCT.</span><br><span class="line">69. 在WHERE, GROUP BY和ORDER BY子句中使用有索引的列.</span><br><span class="line">70. 保持索引简单,不在多个索引中包含同一个列.</span><br><span class="line">71. 有时候MySQL会使用错误的索引,对于这种情况使用USE INDEX.</span><br><span class="line">72. 检查使用SQL_MODE=STRICT的问题.</span><br><span class="line">73. 对于记录数小于5的索引字段，在UNION的时候使用LIMIT不是是用OR.</span><br><span class="line">74. 为了 避免在更新前SELECT，使用INSERT ON DUPLICATE KEY或者INSERT IGNORE ,不要用UPDATE去实现.</span><br><span class="line">75. 不要使用 MAX,使用索引字段和ORDER BY子句.</span><br><span class="line">76. 避免使用ORDER BY RAND().</span><br><span class="line">77. LIMIT M，N实际上可以减缓查询在某些情况下，有节制地使用.</span><br><span class="line">78. 在WHERE子句中使用UNION代替子查询.</span><br><span class="line">79. 对于UPDATES（更新），使用 SHARE MODE（共享模式），以防止独占锁.</span><br><span class="line">80. 在重新启动的MySQL，记得来温暖你的数据库，以确保您的数据在内存和查询速度快.</span><br><span class="line">81. 使用DROP TABLE，CREATE TABLE DELETE FROM从表中删除所有数据.</span><br><span class="line">82. 最小化的数据在查询你需要的数据，使用*消耗大量的时间.</span><br><span class="line">83. 考虑持久连接，而不是多个连接，以减少开销.</span><br><span class="line">84. 基准查询，包括使用服务器上的负载，有时一个简单的查询可以影响其他查询.</span><br><span class="line">85. 当负载增加您的服务器上，使用SHOW PROCESSLIST查看慢的和有问题的查询.</span><br><span class="line">86. 在开发环境中产生的镜像数据中 测试的所有可疑的查询.</span><br></pre></td></tr></table></figure>



<h2 id="MySQL-备份过程"><a href="#MySQL-备份过程" class="headerlink" title="MySQL 备份过程"></a>MySQL 备份过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">87. 从二级复制服务器上进行备份.</span><br><span class="line">88. 在进行备份期间停止复制，以避免在数据依赖和外键约束上出现不一致.</span><br><span class="line">89. 彻底停止MySQL，从数据库文件进行备份.</span><br><span class="line">90. 如果使用 MySQL dump进行备份，请同时备份二进制日志文件 – 确保复制没有中断.</span><br><span class="line">91. 不要信任LVM 快照 – 这很可能产生数据不一致，将来会给你带来麻烦.</span><br><span class="line">92. 为了更容易进行单表恢复，以表为单位导出数据 – 如果数据是与其他表隔离的.</span><br><span class="line">93. 当使用mysqldump时请使用 –opt.</span><br><span class="line">94. 在备份之前检查和优化表.</span><br><span class="line">95. 为了更快的进行导入，在导入时临时禁用外键约束.</span><br><span class="line">96. 为了更快的进行导入，在导入时临时禁用唯一性检测.</span><br><span class="line">97. 在每一次备份后计算数据库，表以及索引的尺寸，以便更够监控数据尺寸的增长.</span><br><span class="line">98. 通过自动调度脚本监控复制实例的错误和延迟.</span><br><span class="line">99. 定期执行备份.</span><br><span class="line">100. 定期测试你的备份.</span><br><span class="line">101: 执行MySQL 监控: Monitis Unveils The World’s First Free On-demand MySQL Monitoring.</span><br></pre></td></tr></table></figure>


    </div>
</article>


<div id="comments-template"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script>
	if(!window.commentConfig) {
      window.commentConfig = {}
      window.commentConfig.title = 'MySQL'
    }
</script>

                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            lzq
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/avatar.jpg" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"></p>
        </div>
    </div>
</aside>
    
    <aside id="sidebar-recent_comments">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-comments"></i>
            最新评论
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day91-100/95.%E4%BD%BF%E7%94%A8Django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/">Django开发商业项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day46-60/46.Django%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">Django快速上手</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Python%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-%E5%9F%BA%E7%A1%80%E7%AF%87-2020/">Python基础题</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E8%8B%B1%E8%AF%AD%E9%9D%A2%E8%AF%95/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98%E5%9B%9E%E7%AD%94/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%94%A8%E5%87%BD%E6%95%B0%E8%BF%98%E6%98%AF%E7%94%A8%E5%A4%8D%E6%9D%82%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%8E%A9%E8%BD%ACPyCharm/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83%E7%A4%BA%E4%BE%8B/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E4%BA%86Python/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E5%B8%B8%E8%A7%81%E5%8F%8D%E7%88%AC%E7%AD%96%E7%95%A5%E5%8F%8A%E5%BA%94%E5%AF%B9%E6%96%B9%E6%A1%88/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/06/12/%E6%80%BB%E7%BB%93/10%E3%80%81Apache/">httpd（Apache）</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/06/14/%E6%80%BB%E7%BB%93/ELK%EF%BC%9A%E6%94%B6%E9%9B%86Docker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97/">ELK：收集Docker容器日志</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day36-45/40.SQL%E8%AF%A6%E8%A7%A3%E4%B9%8BDCL/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day36-45/45.%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E5%92%8CHiveSQL/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day46-60/58.%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B8%88%E9%9D%A2%E8%AF%95%E9%A2%98/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%8E%A9%E8%BD%ACPyCharm/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/problem_of_float/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/old/javascript/example10/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/old/javascript/homework01/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">

                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/6%E3%80%81MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/6%E3%80%81MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/6%E3%80%81MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
                
            </ul>
            <div class="tab-content">
                
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
    <a href="/tags/Python/" style="font-size: 11.860492592551445px;" class="tag-cloud-link">Python</a>
    
    <a href="/tags/Shell/" style="font-size: 11.757259283966981px;" class="tag-cloud-link">Shell</a>
    
    <a href="/tags/Linux/" style="font-size: 19.460184995241217px;" class="tag-cloud-link">Linux</a>
    
    <a href="/tags/Apache/" style="font-size: 15.73592568186923px;" class="tag-cloud-link">Apache</a>
    
    <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 18.485059105976607px;" class="tag-cloud-link">网络</a>
    
    <a href="/tags/Ceph/" style="font-size: 9.493826479485508px;" class="tag-cloud-link">Ceph</a>
    
    <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 17.12858726161476px;" class="tag-cloud-link">阿里云</a>
    
    <a href="/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" style="font-size: 14.509966385583272px;" class="tag-cloud-link">灰度发布</a>
    
    <a href="/tags/MySQL/" style="font-size: 18.718082440852978px;" class="tag-cloud-link">MySQL</a>
    
    <a href="/tags/K8s/" style="font-size: 12.272255718986955px;" class="tag-cloud-link">K8s</a>
    
    <a href="/tags/KVM/" style="font-size: 15.420386503298058px;" class="tag-cloud-link">KVM</a>
    
    <a href="/tags/OpenStack/" style="font-size: 14.184693730999372px;" class="tag-cloud-link">OpenStack</a>
    
    <a href="/tags/Docker/" style="font-size: 15.051456755925056px;" class="tag-cloud-link">Docker</a>
    
    <a href="/tags/Ansible/" style="font-size: 15.254349079141413px;" class="tag-cloud-link">Ansible</a>
    
    <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 8.926695522345447px;" class="tag-cloud-link">负载均衡</a>
    
    <a href="/tags/ELK/" style="font-size: 11.934428484628148px;" class="tag-cloud-link">ELK</a>
    
    <a href="/tags/Nginx/" style="font-size: 13.512483420019226px;" class="tag-cloud-link">Nginx</a>
    
    <a href="/tags/Radis%E3%80%81Mongodb/" style="font-size: 15.008667520873438px;" class="tag-cloud-link">Radis、Mongodb</a>
    
    <a href="/tags/Tomcat/" style="font-size: 8.910563398772418px;" class="tag-cloud-link">Tomcat</a>
    
    <a href="/tags/Jenkins/" style="font-size: 17.94831656007807px;" class="tag-cloud-link">Jenkins</a>
    
    <a href="/tags/DevOps/" style="font-size: 19.69419418749305px;" class="tag-cloud-link">DevOps</a>
    
    <a href="/tags/Prometheus/" style="font-size: 12.9535769500019px;" class="tag-cloud-link">Prometheus</a>
    
    <a href="/tags/Selenium/" style="font-size: 13.629440177974741px;" class="tag-cloud-link">Selenium</a>
    
    <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 13.534871203741032px;" class="tag-cloud-link">爬虫</a>
    
    <a href="/tags/Scrapy/" style="font-size: 16.605709159456246px;" class="tag-cloud-link">Scrapy</a>
    
    <a href="/tags/Django/" style="font-size: 11.671638815569874px;" class="tag-cloud-link">Django</a>
    
</div>
                
                
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="https://www.runoob.com/" target="_blank">菜鸟教程</a>
    </li>
    
    <li>
        <a href="https://www.csdn.net/" target="_blank">CSDN</a>
    </li>
    
    <li>
        <a href="https://nowcoder.com/" target="_blank">牛客网</a>
    </li>
    
    <li>
        <a href="https://www.bilibili.com/" target="_blank">B站</a>
    </li>
    
    <li>
        <a href="https://leetcode-cn.com/" target="_blank">Leetcode</a>
    </li>
    
    <li>
        <a href="https://www.heroku.com/" target="_blank">Heroku</a>
    </li>
    
</div>
                
                
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/lzq2024/" target="_blank">Github</a>
    </li>
    
    <li>
        <a href="https://gitee.com/lzq2024" target="_blank">Gitee</a>
    </li>
    
    <li>
        <a href="https://www.zhihu.com/people/yr1d3j/activities" target="_blank">知乎</a>
    </li>
    
</div>
                
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 lzq Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/Lzq2024" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
</body>

<script src="/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/imgs/slide/background',
      ext: 'jpg',
      maxCount: '7'
    }
</script>

<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>



<script src="/js/oni.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  if(window.commentConfig) {
     window.commentConfig.client_id = 'Ov23lijIsO699goQayhr'
     window.commentConfig.client_secret = 'd4e885f9aa839494f3927fd3fb244c2794e471a8'
     window.commentConfig.owner = 'Lzq2024'
     window.commentConfig.repo = 'gitalk'
     window.commentConfig.id = 'Tue Jun 11 2024 00:00:00 GMT+0800'
   } else {
    window.commentConfig = {
 	client_id: 'Ov23lijIsO699goQayhr',
 	client_secret: 'd4e885f9aa839494f3927fd3fb244c2794e471a8',
	owner: 'Lzq2024',
	repo: 'gitalk',
	id: 'Tue Jun 11 2024 00:00:00 GMT+0800'
      }
   }
</script>

<script src="/js/comment/gitment.js"></script>


</html>