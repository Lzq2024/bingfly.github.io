<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="lzq">
    
    
    
    
    
    
    <title>集群（LVS，Keeplived，Haproxy） | 冰的技术专栏</title>
    <link href="http://bingfly.top" rel="prefetch" />

    
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/bootstrap.min.js"></script>

    
<script src="/js/aos.js"></script>

    
<script src="/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/avatar.jpg'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg,preview7.jpg,preview8.jpg,preview9.jpg,preview10.jpg,preview11.jpg,preview12.jpg,preview13.jpg,preview14.jpg,preview15.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="http://bingfly.top" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>

            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="http://bingfly.top">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">冰的技术专栏</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>分类
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/hexo-%E5%8D%9A%E5%AE%A2/">hexo+博客</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Python%E5%9F%BA%E7%A1%80/">Python基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Python%E9%9D%A2%E8%AF%95/">Python面试</a>
                        </li>
                        
                        
                        <li>
                            <a href="/categories">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-tags"></i>标签
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/tags/Python/">Python</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Shell/">Shell</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Linux/">Linux</a>
                        </li>
                        
                        
                        <li>
                            <a href="/tags">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                <li class="">
                    <a href="/about">
                        <i class="fa fa-user"></i>关于我
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="http://bingfly.top">冰的技术专栏</a>
        >
        <span>集群（LVS，Keeplived，Haproxy）</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2024/06/11/%E6%80%BB%E7%BB%93/5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%88LVS%EF%BC%8CKeeplived%EF%BC%8CHaproxy%EF%BC%89/">集群（LVS，Keeplived，Haproxy）</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-tags"></i>
                
                <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a>
                
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2024-06-11
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%88LVS%EF%BC%8CKeeplived%EF%BC%8CHaproxy%EF%BC%89/">集群（LVS，Keeplived，Haproxy）</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2024-06-11
            </p>
            <p>
                
                <i class="fa fa-tags"></i>
                
                <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <p>[TOC]</p>
<h1 id="一、集群的含义"><a href="#一、集群的含义" class="headerlink" title="一、集群的含义"></a>一、集群的含义</h1><p>由多台主机构成，但对外表现为一个整体</p>
<h1 id="二、集群的分类"><a href="#二、集群的分类" class="headerlink" title="二、集群的分类"></a>二、集群的分类</h1><h2 id="1、负载均衡集群"><a href="#1、负载均衡集群" class="headerlink" title="1、负载均衡集群"></a>1、负载均衡集群</h2><p>1、提高应用系统的响应能力，尽可能处理更多的访问请求，减少延迟为目标，获得高并发，高负载的整体性能</p>
<p>2、LB的负载分配依赖于主节点的分流算法</p>
<h2 id="2、高可用集群"><a href="#2、高可用集群" class="headerlink" title="2、高可用集群"></a>2、高可用集群</h2><p>1、提高应用系统的可靠性，尽可能减少中断时间为目标，确保服务的连续性，达到高可用（HA）的容错效果</p>
<p>2、HA的工作方式包括双工和主从两种模式</p>
<h2 id="3、高性能运算集群"><a href="#3、高性能运算集群" class="headerlink" title="3、高性能运算集群"></a>3、高性能运算集群</h2><p>1、提高应用系统的CPU运算速度，扩展硬件资源和分析能力为目标，获得相当于大型、超级计算机的高性能运算（HPC）能力</p>
<p>2、高性能依赖于“分布式运算”、“并行计算”，通过专用硬件和软件将多个服务器的CPU、内存等资源整合在一起，实现只有大型、超级计算机才具备的计算能力</p>
<h1 id="三、负载均衡集群"><a href="#三、负载均衡集群" class="headerlink" title="三、负载均衡集群"></a>三、负载均衡集群</h1><h2 id="1、架构"><a href="#1、架构" class="headerlink" title="1、架构"></a>1、架构</h2><p>第一层：负载均衡池（LVS）</p>
<p>第二层：服务器池</p>
<p>第三层：共享存储</p>
<h2 id="2、LVS-NAT"><a href="#2、LVS-NAT" class="headerlink" title="2、LVS-NAT"></a>2、LVS-NAT</h2><p><img src="file:///C:/Users/WHH/AppData/Local/Temp/mindmaster/123036356187/001/_CopyPix_1.png" alt="img"></p>
<h3 id="1）、介绍"><a href="#1）、介绍" class="headerlink" title="1）、介绍"></a>1）、介绍</h3><p>1、负载调度器为所有服务节点的网关，即作客户机的访问入口，也是各节点回应客户机的访问出口；</p>
<p>2、服务器节点使用私有IP地址，与调度器处于同一个物理网络，安全性优于其他两种方式。</p>
<p>director（调度器）与RS（服务节点）必须在同一个局域网内。</p>
<p>RS的网关必须指向director的私网DIP。</p>
<p>请求和响应报文都需要director转发，会成为整个系统的瓶颈。</p>
<p>支持端口映射，client访问80端口，director可以映射到RS的8080端口上。</p>
<p>director必须是Linux系统。</p>
<p>director需要两个网卡，一个与互联网通信的公网VIP，一个与RS通信的私网DIP。</p>
<h3 id="2）、环境"><a href="#2）、环境" class="headerlink" title="2）、环境"></a>2）、环境</h3><p>调度服务器一台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.10（内网）</span><br><span class="line"></span><br><span class="line">​      192.168.73.10（外网）</span><br></pre></td></tr></table></figure>

<p>Web服务器两台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.11（Server1）</span><br><span class="line"></span><br><span class="line">IP地址：192.168.100.12（Server2）</span><br></pre></td></tr></table></figure>

<p>NFS共享服务器一台：（可省略）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.13 （内网）</span><br></pre></td></tr></table></figure>



<h3 id="3）、调度器配置"><a href="#3）、调度器配置" class="headerlink" title="3）、调度器配置"></a>3）、调度器配置</h3><p>1、两张网卡，一张用于内网通信，一张用于外网通信</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.100.10（VM1）</span><br><span class="line"></span><br><span class="line">192.168.73.10（VM8）</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@LVS-Server ~]# modprobe ip_vs ###加载LVS内核模块（LVS现已成为Linux内核的一部分，默认编译为ip_vs模块，必要时能够自动调用。以下操作能够手动加载ip_vs模块，并查看当前系统中的ip_vs模块的版本信息）</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# cat /proc/net/ip_vs </span><br><span class="line"></span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096) ###版本信息</span><br><span class="line"></span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line"></span><br><span class="line">  -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# rpm -ivh /mnt/Packages/ipvsadm-1.27-7.el7.x86_64.rpm ###安装管理软件ipvsadm，不需要启动</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# vi /etc/sysctl.conf </span><br><span class="line"></span><br><span class="line">net.ipv4.ip_forward = 1  ###开启路由转发</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# sysctl -p</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# vi nat.sh ###编辑调度服务器脚本</span><br><span class="line"></span><br><span class="line">\#!/bin/bash</span><br><span class="line"></span><br><span class="line">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward ###开启路由地址转换</span><br><span class="line"></span><br><span class="line">ipvsadm -C ###清除内核虚拟服务器表中的所有记录</span><br><span class="line"></span><br><span class="line">ipvsadm -A -t 192.168.73.10:80 -s rr ###创建虚拟服务器</span><br><span class="line"></span><br><span class="line">ipvsadm -a -t 192.168.73.10:80 -r 192.168.100.11:80 -m ###添加服务器节点</span><br><span class="line"></span><br><span class="line">ipvsadm -a -t 192.168.73.10:80 -r 192.168.100.12:80 -m ###添加服务器节点</span><br><span class="line"></span><br><span class="line">ipvsadm -Ln ###查看节点状态，“-n”以数字形式显示显示地址，端口信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# sh nat.sh </span><br><span class="line"></span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line"></span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line"></span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line"></span><br><span class="line">TCP  192.168.73.10:80 rr</span><br><span class="line"></span><br><span class="line">  -&gt; 192.168.100.11:80            Masq    1      0          0         </span><br><span class="line"></span><br><span class="line">  -&gt; 192.168.100.12:80            Masq    1      0          0</span><br></pre></td></tr></table></figure>



<p>ipvsadm命令解析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm命令选项解析：</span><br><span class="line">-C：清除内核虚拟服务器表中的所有记录</span><br><span class="line">-A：增加一台新的虚拟服务器</span><br><span class="line">-t：说明虚拟服务器提供的是tcp的服务</span><br><span class="line">-s rr：启用轮询算法</span><br><span class="line">-a：在一个虚拟服务器中增加一台新的真实服务器</span><br><span class="line">-r：指定真实服务器</span><br><span class="line">-m：指定LVS的工作模式为NAT模式</span><br><span class="line">ipvsadm：启用LVS功能</span><br></pre></td></tr></table></figure>



<h3 id="4）、Web服务器配置"><a href="#4）、Web服务器配置" class="headerlink" title="4）、Web服务器配置"></a>4）、Web服务器配置</h3><p>1、网关为调度器内网IP；</p>
<p>2、route -n查看是否有默认路由生成；</p>
<p>3、挂载NFS共享</p>
<h3 id="5）、验证方式"><a href="#5）、验证方式" class="headerlink" title="5）、验证方式"></a>5）、验证方式</h3><p>访问调度器外网IP，刷新看是否会轮询</p>
<h2 id="3、LVS-DR"><a href="#3、LVS-DR" class="headerlink" title="3、LVS-DR"></a>3、LVS-DR</h2><p><img src="file:///C:/Users/WHH/AppData/Local/Temp/mindmaster/123036356187/001/_CopyPix_1_2.png" alt="img"></p>
<h3 id="1）、特点"><a href="#1）、特点" class="headerlink" title="1）、特点"></a>1）、特点</h3><p>1、保证前端路由将目标地址为VIP的报文全部发送给DS，而不是RS</p>
<p>2、RS的RIP可以使用私有地址，但也可以使用公网地址</p>
<p>3、RS和director必须在同一物理网络中</p>
<p>4、请求报文有director调度，但响应报文不一定经由director</p>
<p>不支持端口映射</p>
<p>5、RS的网关不能指向DIP（LVS服务器IP）</p>
<h3 id="2）、报文转发过程"><a href="#2）、报文转发过程" class="headerlink" title="2）、报文转发过程"></a>2）、报文转发过程</h3><p>1）client发送请求到vip，real-server配置限制对vip应答arp，而lvs会对vip响应arp，因此client将请求发到LVS。</p>
<p>2）LVS机器收到发往vip的报文后，根据目的IP和目的port匹配ipvs规则，将报文目的mac改为real server的mac，同时将源mac改为LVS的mac后，发送到real server。</p>
<p>3）real server收到之后，mac&#x2F;IP都是本机的，就将报文交由系统处理。</p>
<p>4）回程报文因real server收到的报文源IP就是client IP，real server直接将请求回给client。如果client和real server是同一个网段，响应报文直接通过二层透传发送给client，报文目的mac即为client mac；如果client和real server不是同一个网段，响应报文先发送到gateway，再走三层转发返回client。</p>
<h3 id="3）、环境"><a href="#3）、环境" class="headerlink" title="3）、环境"></a>3）、环境</h3><p>调度服务器一台；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.10</span><br></pre></td></tr></table></figure>

<p>Web服务器两台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.11（Server1）</span><br><span class="line"></span><br><span class="line">IP地址：192.168.100.12（Server2）</span><br></pre></td></tr></table></figure>

<p>NFS共享服务器一台：（可省略）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP地址：192.168.100.13 </span><br></pre></td></tr></table></figure>



<h3 id="4）、调度器配置"><a href="#4）、调度器配置" class="headerlink" title="4）、调度器配置"></a>4）、调度器配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@LVS-Server ~]# modprobe ip_vs ###加载LVS内核模块（LVS现已成为Linux内核的一部分，默认编译为ip_vs模块，必要时能够自动调用。以下操作能够手动加载ip_vs模块，并查看当前系统中的ip_vs模块的版本信息）</span><br><span class="line">[root@LVS-Server ~]# cat /proc/net/ip_vs </span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096) ###版本信息</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConn</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# rpm -ivh /mnt/Packages/ipvsadm-1.27-7.el7.x86_64.rpm ###安装管理软件ipvsadm，不需要启动</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# vi /etc/sysctl.conf </span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# vi dr.sh ###编辑调度服务器脚本</span><br><span class="line">#!/bin/bash</span><br><span class="line">ifconfig ens33:0 192.168.100.100 broadcast 192.168.100.100 netmask 255.255.255.255 up ###添加虚拟地址的虚接口</span><br><span class="line">route add -host 192.168.100.100 dev ens33:0 ###给ens33：0添加路由</span><br><span class="line">ipvsadm -C ###清除内核虚拟服务器表中的所有记录</span><br><span class="line">ipvsadm -A -t 192.168.100.100:80 -s rr ###创建虚拟服务器</span><br><span class="line">ipvsadm -a -t 192.168.100.100:80 -r 192.168.100.11:80 -g ###添加服务器节点</span><br><span class="line">ipvsadm -a -t 192.168.100.100:80 -r 192.168.100.12:80 -g ###添加服务器节点</span><br><span class="line">ipvsadm -Ln ###查看节点状态，加个“-n”将以数字形式显示地址、端口信息</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# sh dr.sh</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  192.168.100.100:80 rr</span><br><span class="line">  -&gt; 192.168.100.12:80            Route   1      0          0</span><br><span class="line">  -&gt; 192.168.100.11:80            Route   1      0          0</span><br><span class="line"></span><br><span class="line">[root@LVS-Server ~]# ip addr ###看是否有虚拟路由生成</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:42:ea:42 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.100.10/24 brd 192.168.100.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.100.100/32 brd 192.168.100.100 scope global ens33:0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a2b4:ea7e:78e6:4f86/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN qlen 1000</span><br><span class="line">    link/ether 52:54:00:ea:07:54 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 1000</span><br><span class="line">    link/ether 52:54:00:ea:07:54 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>



<h3 id="5）、Web服务器配置"><a href="#5）、Web服务器配置" class="headerlink" title="5）、Web服务器配置"></a>5）、Web服务器配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@Web1 ~]# vi web.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">ifconfig lo:0 192.168.100.100 broadcast 192.168.100.100 netmask 255.255.255.255 up</span><br><span class="line">route add -host 192.168.100.100 dev lo:0</span><br><span class="line">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">echo &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">echo &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">sysctl -p &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">[root@Web1 ~]# sh web.sh</span><br><span class="line">[root@Web1 ~]# ifconfig ###查看是否有虚拟路由生成</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.100.11  netmask 255.255.255.0  broadcast 192.168.100.255</span><br><span class="line">        inet6 fe80::e654:4e48:ec26:2279  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:9f:bd:e6  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 713398  bytes 1035992165 (987.9 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 59733  bytes 3967447 (3.7 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 164  bytes 18108 (17.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 164  bytes 18108 (17.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo:0: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 192.168.100.100  netmask 255.255.255.255</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:dc:14:16  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>



<h3 id="6）、验证方式"><a href="#6）、验证方式" class="headerlink" title="6）、验证方式"></a>6）、验证方式</h3><p>访问虚拟IP，看是否会进行轮询</p>
<h1 id="四、负载均衡-高可用集群"><a href="#四、负载均衡-高可用集群" class="headerlink" title="四、负载均衡+高可用集群"></a>四、负载均衡+高可用集群</h1><h2 id="1、LVS-Keepalived"><a href="#1、LVS-Keepalived" class="headerlink" title="1、LVS+Keepalived"></a>1、LVS+Keepalived</h2><h3 id="1）、实现原理"><a href="#1）、实现原理" class="headerlink" title="1）、实现原理"></a>1）、实现原理</h3><p>1、由多台路由器组成一个热备组，通过共用的虚拟IP地址对外提供服务；</p>
<p>2、每个热备组内同时只有一台主路由器提供服务，其他路由器处于冗余状态；</p>
<p>3、若当前在线的路由器失效，则其他路由器会根据设置的优先级自动接替虚拟IP地址，继续提供服务</p>
<h3 id="2）、故障切换"><a href="#2）、故障切换" class="headerlink" title="2）、故障切换"></a>2）、故障切换</h3><p>是由虚拟IP地址的漂移来实现的，适用于各种应用服务器</p>
<h3 id="3）、主要优势"><a href="#3）、主要优势" class="headerlink" title="3）、主要优势"></a>3）、主要优势</h3><p>1、对LVS负载调度器实现热备切换，提高可用性</p>
<p>2、对服务器池中的节点进行健康检查，自动移除失效节点，恢复后再重新加入</p>
<h3 id="4）、Master节点"><a href="#4）、Master节点" class="headerlink" title="4）、Master节点"></a>4）、Master节点</h3><p>（1）全局配置、热备参数配置</p>
<p>要为master和backup调度器实现热备功能，漂移地址使用LVS群集的VIP地址</p>
<p>（2）Web服务器池配置</p>
<p>在keepalived的热备配置基础上，添加“virtual_server VIP 端口 {…}”区段来配置虚拟服务器</p>
<p>包括负载调度算法、群集工作模式、健康检查间隔、真实服务器地址等参数</p>
<h3 id="5）、Backup节点"><a href="#5）、Backup节点" class="headerlink" title="5）、Backup节点"></a>5）、Backup节点</h3><p>和master服务器有三个配置要不相同，其余配置均相同：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（1）router_id：设和其他web服务器不一样的名称</span><br><span class="line"></span><br><span class="line">（2）state：设为BACKUP</span><br><span class="line"></span><br><span class="line">（3）priority：值要低于主服务器</span><br></pre></td></tr></table></figure>



<h3 id="6）、具体配置"><a href="#6）、具体配置" class="headerlink" title="6）、具体配置"></a>6）、具体配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@Server1 ~]# modprobe ip_vs ###加载ip_vs模块</span><br><span class="line">[root@Server1 ~]# rpm -ivh /mnt/Packages/ipvsadm-1.27-7.el7.x86_64.rpm ###安装管理软件ipvsadm</span><br><span class="line"></span><br><span class="line">[root@Server1 ~]# yum -y install gcc gcc-c++ make popt-devel kernel-devel openssl-devel</span><br><span class="line">[root@Server1 ~]# tar zxf keepalived-2.0.13.tar.gz</span><br><span class="line">[root@Server1 ~]# cd keepalived-2.0.13/</span><br><span class="line">[root@Server1 keepalived-2.0.13]# ./configure --prefix=/</span><br><span class="line">[root@Server1 keepalived-2.0.13]# make &amp;&amp; make install</span><br><span class="line">[root@Server1 keepalived-2.0.13]# cp keepalived/etc/init.d/keepalived /etc/init.d ###加入系统管理服务</span><br><span class="line">[root@Server1 keepalived-2.0.13]# systemctl enable keepalived.service ###设置开机自启动</span><br><span class="line">[root@Server1 ~]# vi /etc/keepalived/keepalived.conf ###编辑配置文件</span><br><span class="line">global_defs &#123;         #全局参数</span><br><span class="line">   router_id LVS_01        #指定名称，各个服务器名称要不一样</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">vrrp_instance VI_1 &#123;         #指定vrrp热备参数</span><br><span class="line">    state MASTER      #服务器角色是master，备份服务器设置为BACKUP</span><br><span class="line">    interface ens33     #修改物理网卡名称，默认是centos6的eth0</span><br><span class="line">    virtual_router_id 51  #组号相同</span><br><span class="line">    priority 100        #优先级，主服务器设置要大于备服务器</span><br><span class="line">   authentication &#123;</span><br><span class="line">        auth_type PASS  #验证类型和密码，不建议修改</span><br><span class="line">        auth_pass 1111   </span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100      #漂移地址（VIP）地址，可以有多个</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.100.100 80 &#123;            #配置虚拟服务器</span><br><span class="line">    delay_loop 6</span><br><span class="line">    protocol TCP         #健康检查用的是TCP还是UDP</span><br><span class="line">    lb_algo rr       #调度算法为轮询</span><br><span class="line">    lb_kind DR    #LVS的工作模式为DR（直连路由）</span><br><span class="line"></span><br><span class="line">    real_server 192.168.100.12 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;            #健康检查参数</span><br><span class="line">            connect_port 80      #检查80端口连接是否正常</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">real_server 192.168.100.13 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_port 80</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2、Haproxy"><a href="#2、Haproxy" class="headerlink" title="2、Haproxy"></a>2、Haproxy</h2><h3 id="1）、与LVS的区别"><a href="#1）、与LVS的区别" class="headerlink" title="1）、与LVS的区别"></a>1）、与LVS的区别</h3><p>1、LVS在企业应用中抗负载能力很强，但存在不足</p>
<p>LVS不支持正则处理，不能实现动静分离（nginx都支持）</p>
<p>对于大型网站，LVS的实施配置复杂，维护成本相对较高</p>
<p>2、Haproxy是一款可提供高可用性、负载均衡、及基于TCP和HTTP应用的代理的软件</p>
<p>适用于负载大的Web站点</p>
<p>运行在硬件上可支持数以万计的并发连接的连接请求</p>
<h3 id="2）、Haproxy调度算法原理"><a href="#2）、Haproxy调度算法原理" class="headerlink" title="2）、Haproxy调度算法原理"></a>2）、Haproxy调度算法原理</h3><p>第一种（RR）：</p>
<p>RR算法是最简单最常用的一种算法，即轮询调度</p>
<p>理解举例</p>
<p>有三个节点A、B、C，第一个用户访问会被指派到节点A，第二个用户访问会被指派到节点B，第三个用户访问会被指派到C节点</p>
<p>第四个用户访问继续指派到节点A，轮询分配访问请求实现负载均衡效果</p>
<p>第二种（LC）：</p>
<p>LC算法即最小连接数算法，根据后端的节点连接数大小动态分配前端请求</p>
<p>理解举例</p>
<p>有三个节点A、B、C，各节点的连接数分别为A:4、B:5、C:6，此时如果有第一个用户连接请求，会被指派到A上，连接数变为A:5、B:5、C:6</p>
<p>第二个用户请求会继续分配到A上，连接数变为A6、B：5、C：6；再有新的请求会分配给B，每次将新的请求指派给连接数最小的客户端</p>
<p>由于实际情况下A、B、C的连接数会动态释放，很难会出现一样连接数的情况，因此此算法相比较rr算法有很大改进，是目前用到比较多的一种算法</p>
<p>第三种（SH）：</p>
<p>SH即基于来源访问调度算法，此算法用于一些有 Session会话记录在服务器端的场景，可以基于来源的IP、Cookie等做集群调度（上一次请求分给哪个web服务器的下次还是分给该服务器）</p>
<p>理解举例</p>
<p>有三个节点A、B、C，第一个用户第一次访问被指派到了A，第二个用户第次访问被指派到了B</p>
<p>当第一个用户第二次访问时会被继续指派到A，第二个用户第二次访问时依旧会被指派到B，只要负载均衡调度器不重启，第一个用户访问都会被指派到A，第二个用户访问都会被指派到B，实现集群的调度</p>
<p>此调度算法好处是实现会话保持，但某些IP访问量非常大时会引起负载不均衡，部分节点访问量超大，影响业务使用</p>
<h3 id="3）、配置文件详解"><a href="#3）、配置文件详解" class="headerlink" title="3）、配置文件详解"></a>3）、配置文件详解</h3><h4 id="1、global：全局配置"><a href="#1、global：全局配置" class="headerlink" title="1、global：全局配置"></a>1、global：全局配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、log127.0.0.1 lcal0：配置日志记录，local0为日志设备，默认存放到系统日志</span><br><span class="line"></span><br><span class="line">2、log127.0.0.1 loca1 notice:notice为日志级别，通常有24个级别</span><br><span class="line"></span><br><span class="line">3、maxconn4096：最大连接数</span><br><span class="line"></span><br><span class="line">4、uid 99：用户uid</span><br><span class="line"></span><br><span class="line">5、gid 99：用户gid</span><br></pre></td></tr></table></figure>



<h4 id="2、defaults：默认配置"><a href="#2、defaults：默认配置" class="headerlink" title="2、defaults：默认配置"></a>2、defaults：默认配置</h4><p>一般会被应用组件继承，如果在应用组件中没有特别声明，将安装默认配置参数设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、log global：定义日志为global配置中的日志定义</span><br><span class="line"></span><br><span class="line">2、mode http：模式为http</span><br><span class="line"></span><br><span class="line">3、option httplog：采用http日志格式记录日志</span><br><span class="line"></span><br><span class="line">4、retries 3：检查节点服务器失败连续达到三次则认为节点不可用</span><br><span class="line"></span><br><span class="line">5、maxconn2000：最大连接数</span><br><span class="line"></span><br><span class="line">6、contimeout5000：连接超时时间</span><br><span class="line"></span><br><span class="line">7、clitimeout50000：客户端超时时间</span><br><span class="line"></span><br><span class="line">8、srvtimeout50000：服务器超时时间</span><br></pre></td></tr></table></figure>



<h4 id="3、listen：应用组件配置"><a href="#3、listen：应用组件配置" class="headerlink" title="3、listen：应用组件配置"></a>3、listen：应用组件配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、listen appli4- backup 0.0.0.0:10004：定义一个appli4- backup的应用</span><br><span class="line"></span><br><span class="line">2、option httpchk /index.html检查服务器的index.html文件</span><br><span class="line"></span><br><span class="line">3、option persist：强制将请求发送到已经down掉的服务器（注释掉，否则起服务会报错）</span><br><span class="line"></span><br><span class="line">4、balance roundrobin：负载均衡调度算法使用轮询算法</span><br><span class="line"></span><br><span class="line">5、server inst1 192.168.114.56:80 check inter 2000 fall 3：定义在线节点</span><br><span class="line"></span><br><span class="line">6、server inst2 192.168 114.56:81 check inter 2000 fall 3 backup：定义备份节点</span><br></pre></td></tr></table></figure>



<h3 id="4）、具体配置"><a href="#4）、具体配置" class="headerlink" title="4）、具体配置"></a>4）、具体配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy haproxy]# vim haproxy.cfg</span><br><span class="line"></span><br><span class="line">下面两项前面加上注释</span><br><span class="line"></span><br><span class="line">\#chroot /usr/share/haproxy    #固有目录，可注释掉</span><br><span class="line"></span><br><span class="line">\#redispatch      #当使用了cookie时，haproxy将会将其请求的后端服务器的serverID插入到cookie中，以保证会话的SESSION持久性；而此时，如果后端的服务器宕掉了，但是客户端的cookie是不会刷新的，如果设置此参数，将会将客户的请求强制定向到另外一个后端server上，以保证服务的正常。需要注释掉</span><br><span class="line"></span><br><span class="line">将原来的listen配置项删除，添加如下参数：</span><br><span class="line"></span><br><span class="line">listen webcluster 0.0.0.0:80</span><br><span class="line"></span><br><span class="line">​       option httpchk GET /index.html</span><br><span class="line"></span><br><span class="line">​       balance roundrobin</span><br><span class="line"></span><br><span class="line">​       server web1 192.168.73.20:80 check inter 2000 fall 3</span><br><span class="line"></span><br><span class="line">​       server web2 192.168.73.30:80 check inter 2000 fall 3</span><br></pre></td></tr></table></figure>



<h3 id="5）、日志管理"><a href="#5）、日志管理" class="headerlink" title="5）、日志管理"></a>5）、日志管理</h3><p>1、默认是输出到系统的syslog（系统日志）中，生成环境中一般单独定义</p>
<p>2、具体配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# vi /etc/haproxy/haproxy.cfg</span><br><span class="line">global</span><br><span class="line">        log /dev/log    local0 info</span><br><span class="line">        log /dev/log    local0 notice</span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# vi /etc/rsyslog.d/haproxy.conf</span><br><span class="line">if ($programname == &#x27;haproxy&#x27; and $syslogseverity-text == &#x27;info&#x27;)</span><br><span class="line">then -/var/log/haproxy/haproxy-info.log</span><br><span class="line">&amp;~</span><br><span class="line">if ($programname == &#x27;haproxy&#x27; and $syslogseverity-text == &#x27;notice&#x27;)</span><br><span class="line">then -/var/log/haproxy/haproxy-notice.log</span><br><span class="line">&amp;~</span><br><span class="line">[root@Haproxy ~]# systemctl restart rsyslog.service</span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# cd /var/log/haproxy/ ###可看日志信息</span><br><span class="line">[root@Haproxy haproxy]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-------. 1 root root 329 11月  5 18:02 haproxy-info.log</span><br><span class="line">-rw-------. 1 root root 132 11月  5 18:02 haproxy-notice.log</span><br></pre></td></tr></table></figure>



<h3 id="6）、参数优化"><a href="#6）、参数优化" class="headerlink" title="6）、参数优化"></a>6）、参数优化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、maxconn：最大连接数，根据应用实际情况进行调整，推荐使用10240</span><br><span class="line"></span><br><span class="line">2、daemon：守护进程模式， Haproxy可以使用非守护进程模式启动，建议使用守护进程模式启动</span><br><span class="line"></span><br><span class="line">3、nbproc：负载均衡的并发进程数，建议与当前服务器CPU核数相等或为其2倍</span><br><span class="line"></span><br><span class="line">4、retries：重试次数，主要用于对集群节点的检查，如果节点多，且并发量大，设置为2次或3次</span><br><span class="line"></span><br><span class="line">5、option http-server-close：主动关闭http请求选项，建议在生产环境中使用此选项</span><br><span class="line"></span><br><span class="line">6、timeout http-keep-alive：长连接超时时间，设置长连接超时时间，可以设置为10s</span><br><span class="line"></span><br><span class="line">7、timeout http-request：http请求超时时间，建议将此时间设置为5~10s，增加http连接释放速度</span><br><span class="line"></span><br><span class="line">8、timeout client：客户端超时时间，如果访问量过大，节点响应慢，可以将此时间设置短一些，建议设置为1min左右就可以了</span><br></pre></td></tr></table></figure>





<h1 id="五、负载均衡-keepalived故障："><a href="#五、负载均衡-keepalived故障：" class="headerlink" title="五、负载均衡+keepalived故障："></a>五、负载均衡+keepalived故障：</h1><h2 id="1-keepalived服务启动了，但是VIP没出来"><a href="#1-keepalived服务启动了，但是VIP没出来" class="headerlink" title="1.keepalived服务启动了，但是VIP没出来"></a>1.keepalived服务启动了，但是VIP没出来</h2><p>主要是启动keepalived服务的时候不会报错；</p>
<p>vrrp_scripts{}中定义了一个函数，里面放了判断nginx存活的脚本，下面track_script{}注意位置，要包含在vrrp_instance{}实例中；  （因为一个括号问题排障了接近一个多小时，VIP就是起不来）</p>
<h2 id="2-负载均衡常见典型故障"><a href="#2-负载均衡常见典型故障" class="headerlink" title="2.负载均衡常见典型故障"></a>2.负载均衡常见典型故障</h2><p>后台服务器down了，nginx就不会分配请求给它了，但是如果没有down，只是返回异常状态码了，比如504、502、404等，这时需要多一个负载均衡的配置，如下：</p>
<p>proxy_next_upstream http_500 | http_502 | http_503 | http_504 |http_404;意思是，当其中一台返回错误码404,500…等错误时，可以分配到下一台服务器程序继续处理，提高平台访问成功率</p>
<h2 id="3-Nginx负载均衡优化"><a href="#3-Nginx负载均衡优化" class="headerlink" title="3.Nginx负载均衡优化"></a>3.Nginx负载均衡优化</h2><h3 id="（1）健康检查"><a href="#（1）健康检查" class="headerlink" title="（1）健康检查"></a>（1）健康检查</h3><p>下载nginx_upstream_check模块第三方模块   master.zip</p>
<p>upstream web {</p>
<p>​    server 172.16.1.7:80 max_fails&#x3D;2 fail_timeout&#x3D;10s;</p>
<p>​    server 172.16.1.8:80 max_fails&#x3D;2 fail_timeout&#x3D;10s;</p>
<p>​    check interval&#x3D;3000 rise&#x3D;2 fall&#x3D;3 timeout&#x3D;1000 type&#x3D;tcp;</p>
<p>​    #interval  检测间隔时间，单位为毫秒</p>
<p>​    #rise      表示请求2次正常，标记此后端的状态为up</p>
<p>​    #fall      表示请求3次失败，标记此后端的状态为down</p>
<p>​    #type      类型为tcp</p>
<p>​    #timeout   超时时间，单位为毫秒</p>
<p>location &#x2F;upstream_check {</p>
<p>​        check_status;</p>
<h3 id="（2）nginx配置文件中调优"><a href="#（2）nginx配置文件中调优" class="headerlink" title="（2）nginx配置文件中调优"></a>（2）nginx配置文件中调优</h3><p>1、worker_processes 8;</p>
<p>nginx 进程数，建议按照cpu 数目来指定，一般为它的倍数 (如,2个四核的cpu计为8)。</p>
<p>2、worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000;</p>
<p>为每个进程分配cpu，上例中将8个进程分配到8个cpu，当然可以写多个，或者将一个进程分配到多个cpu。</p>
<p>3、worker_rlimit_nofile 65535;</p>
<p>这个指令是指当一个nginx 进程打开的最多文件描述符数目，理论值应该是最多打开文</p>
<p>件数（ulimit -n）与nginx 进程数相除，但是nginx 分配请求并不是那么均匀，所以最好与ulimit -n 的值保持一致。</p>
<p>现在在linux 2.6内核下开启文件打开数为65535，worker_rlimit_nofile就相应应该填写65535。</p>
<p>这是因为nginx调度时分配请求到进程并不是那么的均衡，所以假如填写10240，总并发量达到3-4万时就有进程可能超过10240了，这时会返回502错误。</p>
<p>4、use epoll;</p>
<p>使用epoll 的I&#x2F;O 模型</p>
<h1 id="六、如何进一步优化负载均衡群集架构？"><a href="#六、如何进一步优化负载均衡群集架构？" class="headerlink" title="六、如何进一步优化负载均衡群集架构？"></a>六、如何进一步优化负载均衡群集架构？</h1><p>使用外部两台LVS作为接入入口；进入之后再用多台nginx来分担请求</p>
<p>1.在keepalived+nginx的主备容灾高可用的架构中，nginx是作为外部访问系统的唯一入口，理论上一台nginx的最大并发量可以高达50000，但是当并发量更大的时候，keepalived+nginx的高可用机制是没办法满足需求的，因为keepalived+nginx的架构中只有一台nginx在工作（VIP在一台上），只有当master宕机或异常时候，备份机才会上位。那么如何解决更大的高并发问题呢，也许会问能不能搭建nginx集群，直接对外提供访问？</p>
<p>很显然这是欠妥当的，因为当nginx作为外部的唯一访问入口，没办法直接以集群的形式对外提供服务。但是在内网环境下，是可以用nginx集群（nginx横向扩展服务集合）的，当然总得有一个对外入口，所以需要在nginx集群之上，在加一层负载均衡器（两个LVS)，作为系统的唯一入口。</p>
<p>2.LVS都有哪些模式，你们公司用的哪一种？</p>
<p>DR模式：客户端请求是到负载均衡器，负载均衡器将请求分发给后面的真实服务器之后，服务器直接回应到客户端</p>
<p>优点：</p>
<p>DR模式相对于NAT模式，RealServer直接在不经DirectServer的情况下直接将客户端的访问结果返回至给客户端,效率更加高效；</p>
<p>缺点：</p>
<p>所有的RealServer和DirectServer必须在同一局域网中；</p>
<p>除了这个DR模式之外，我还了解过IP隧道模式和NAT模式，不过没有在生产中用过。</p>
<p>IPVS的运行，使用的服务器资源主要是 CPU、内存I&#x2F;O、网络I&#x2F;O；IPVS完全运行在内存中，并且运行在内核态。</p>
<p>当IPVS的应用在DR模式时，既不耗CPU，也不耗I&#x2F;O，运行非常快，所以系统负载非常的低，跟据我的经验，一般负载总是0。所以 LVS 应用对服务器的配置要求非常低。以为 LVS 很重要，所以配置一个相当高端的服务器，实在是一种浪费。</p>
<p>其实我们可以做一下计算：</p>
<p>就是说，当系统当前有100 万连接的时候，才用去内存 208 M，所以  IPVS 的主机，即使是1G的内存，也足以承载负载。</p>
<h1 id="七、Haproxy和LVS-NGINX对比"><a href="#七、Haproxy和LVS-NGINX对比" class="headerlink" title="七、Haproxy和LVS&#x2F;NGINX对比"></a>七、Haproxy和LVS&#x2F;NGINX对比</h1><p>（1）LVS在企业应用中康复在能力很强，但存在不足，LVS不支持正则处理，不能实现动静分离，对于大型网站，LVS的实施配置复杂，维护成本相对较高。</p>
<p>（2）haproxy特别适用于那些高负载、访问量很大，但提供高可用性、负载均衡、及TCP（四层）和HTTP（七层）应用的代理的软件的业务应用，不能实现动静分离。</p>
<p>（3）nginx配置简单，可以在实现负载均衡的同时，处理静态页面，分担Tomcat的负担。</p>
<p>LVS、Nginx、HAproxy有什么区别？工作中你怎么选择？</p>
<p>LVS：Linux Virtual Server的简写，意即Linux虚拟服务器，是一个虚拟的服务器集群系统。</p>
<p>LVS： 是基于四层的转发</p>
<p>Nginx：Nginx是一款轻量级的web 服务器&#x2F;反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器，并在一个BSD-like协议下发行。</p>
<p>Nginx： 是WEB服务器，缓存服务器，又是反向代理服务器，可以做七层的转发</p>
<p>HAproxy：HAproxy是一个使用C语言编写的自由及开放源代码软件[1]，其提供高可用性，负载均衡，以及基于TCP和HTTP的应用程序代理。</p>
<p>HAproxy： 是基于四层和七层的转发，是专业的代理服务器</p>
<p>区别： LVS由于是基于四层的转发所以只能做端口的转发，而基于URL的、基于目录的这种转发LVS就做不了</p>
<p>总结：通过概念方面，我们可以看得出来，都可以提供高可用和负载均衡等的服务，所以从概念方面，没有什么区别</p>
<p>工作选择：</p>
<p>HAproxy和Nginx由于可以做七层的转发，所以URL和目录的转发都可以做</p>
<p>在很大并发量的时候我们就要选择LVS，像中小型公司的话并发量没那么大</p>
<p>选择HAproxy或者Nginx足已，由于HAproxy由是专业的代理服务器</p>
<p>配置简单，所以中小型企业推荐使用HAproxy</p>

    </div>
</article>


<div id="comments-template"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script>
	if(!window.commentConfig) {
      window.commentConfig = {}
      window.commentConfig.title = '集群（LVS，Keeplived，Haproxy）'
    }
</script>

                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            lzq
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/avatar.jpg" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"></p>
        </div>
    </div>
</aside>
    
    <aside id="sidebar-recent_comments">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-comments"></i>
            最新评论
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day91-100/95.%E4%BD%BF%E7%94%A8Django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/">Django开发商业项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day46-60/46.Django%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">Django快速上手</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Python%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-%E5%9F%BA%E7%A1%80%E7%AF%87-2020/">Python基础题</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E8%8B%B1%E8%AF%AD%E9%9D%A2%E8%AF%95/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98%E5%9B%9E%E7%AD%94/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%94%A8%E5%87%BD%E6%95%B0%E8%BF%98%E6%98%AF%E7%94%A8%E5%A4%8D%E6%9D%82%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%8E%A9%E8%BD%ACPyCharm/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83%E7%A4%BA%E4%BE%8B/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E4%BA%86Python/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E5%B8%B8%E8%A7%81%E5%8F%8D%E7%88%AC%E7%AD%96%E7%95%A5%E5%8F%8A%E5%BA%94%E5%AF%B9%E6%96%B9%E6%A1%88/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/06/13/%E6%80%BB%E7%BB%93/1%E3%80%81k8s/">Kubernetes</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day36-45/40.SQL%E8%AF%A6%E8%A7%A3%E4%B9%8BDCL/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day66-80/67.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/old/javascript/homework08/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/css_practice_3.result/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/example_of_css_2/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/example_of_jquery_2/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/index/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/js_practice_4/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/js/hello/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">

                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%88LVS%EF%BC%8CKeeplived%EF%BC%8CHaproxy%EF%BC%89/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%88LVS%EF%BC%8CKeeplived%EF%BC%8CHaproxy%EF%BC%89/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%88LVS%EF%BC%8CKeeplived%EF%BC%8CHaproxy%EF%BC%89/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
                
            </ul>
            <div class="tab-content">
                
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
    <a href="/tags/Python/" style="font-size: 11.329776354166706px;" class="tag-cloud-link">Python</a>
    
    <a href="/tags/Shell/" style="font-size: 16.052659828284376px;" class="tag-cloud-link">Shell</a>
    
    <a href="/tags/Linux/" style="font-size: 9.35559550015936px;" class="tag-cloud-link">Linux</a>
    
    <a href="/tags/Apache/" style="font-size: 9.112970296040139px;" class="tag-cloud-link">Apache</a>
    
    <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 16.573820220716108px;" class="tag-cloud-link">网络</a>
    
    <a href="/tags/Ceph/" style="font-size: 9.885369115132704px;" class="tag-cloud-link">Ceph</a>
    
    <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 15.295638591708979px;" class="tag-cloud-link">阿里云</a>
    
    <a href="/tags/K8s/" style="font-size: 12.045334669818988px;" class="tag-cloud-link">K8s</a>
    
    <a href="/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" style="font-size: 14.80524257995787px;" class="tag-cloud-link">灰度发布</a>
    
    <a href="/tags/MySQL/" style="font-size: 8.797442680504272px;" class="tag-cloud-link">MySQL</a>
    
    <a href="/tags/KVM/" style="font-size: 10.960448855732391px;" class="tag-cloud-link">KVM</a>
    
    <a href="/tags/OpenStack/" style="font-size: 11.549278350035394px;" class="tag-cloud-link">OpenStack</a>
    
    <a href="/tags/Docker/" style="font-size: 12.972757033201828px;" class="tag-cloud-link">Docker</a>
    
    <a href="/tags/ELK/" style="font-size: 17.069555585372253px;" class="tag-cloud-link">ELK</a>
    
    <a href="/tags/Ansible/" style="font-size: 9.854222608051945px;" class="tag-cloud-link">Ansible</a>
    
    <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 13.123585051231888px;" class="tag-cloud-link">负载均衡</a>
    
    <a href="/tags/Radis%E3%80%81Mongodb/" style="font-size: 9.562399511748165px;" class="tag-cloud-link">Radis、Mongodb</a>
    
    <a href="/tags/Nginx/" style="font-size: 16.46497555656911px;" class="tag-cloud-link">Nginx</a>
    
    <a href="/tags/Tomcat/" style="font-size: 17.879954447264076px;" class="tag-cloud-link">Tomcat</a>
    
    <a href="/tags/DevOps/" style="font-size: 12.821846488241757px;" class="tag-cloud-link">DevOps</a>
    
    <a href="/tags/Jenkins/" style="font-size: 17.62059660895718px;" class="tag-cloud-link">Jenkins</a>
    
    <a href="/tags/Prometheus/" style="font-size: 14.304025428066673px;" class="tag-cloud-link">Prometheus</a>
    
    <a href="/tags/Django/" style="font-size: 14.716650150908887px;" class="tag-cloud-link">Django</a>
    
    <a href="/tags/Selenium/" style="font-size: 17.27502555914682px;" class="tag-cloud-link">Selenium</a>
    
    <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15.820397266700413px;" class="tag-cloud-link">爬虫</a>
    
    <a href="/tags/Scrapy/" style="font-size: 16.033284353577056px;" class="tag-cloud-link">Scrapy</a>
    
</div>
                
                
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="https://www.runoob.com/" target="_blank">菜鸟教程</a>
    </li>
    
    <li>
        <a href="https://www.csdn.net/" target="_blank">CSDN</a>
    </li>
    
    <li>
        <a href="https://nowcoder.com/" target="_blank">牛客网</a>
    </li>
    
    <li>
        <a href="https://www.bilibili.com/" target="_blank">B站</a>
    </li>
    
    <li>
        <a href="https://leetcode-cn.com/" target="_blank">Leetcode</a>
    </li>
    
    <li>
        <a href="https://www.heroku.com/" target="_blank">Heroku</a>
    </li>
    
</div>
                
                
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/lzq2024/" target="_blank">Github</a>
    </li>
    
    <li>
        <a href="https://gitee.com/lzq2024" target="_blank">Gitee</a>
    </li>
    
    <li>
        <a href="https://www.zhihu.com/people/yr1d3j/activities" target="_blank">知乎</a>
    </li>
    
</div>
                
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 lzq Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/Lzq2024" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
</body>

<script src="/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/imgs/slide/background',
      ext: 'jpg',
      maxCount: '7'
    }
</script>

<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>



<script src="/js/oni.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  if(window.commentConfig) {
     window.commentConfig.client_id = 'Ov23lijIsO699goQayhr'
     window.commentConfig.client_secret = 'd4e885f9aa839494f3927fd3fb244c2794e471a8'
     window.commentConfig.owner = 'Lzq2024'
     window.commentConfig.repo = 'gitalk'
     window.commentConfig.id = 'Tue Jun 11 2024 00:00:00 GMT+0800'
   } else {
    window.commentConfig = {
 	client_id: 'Ov23lijIsO699goQayhr',
 	client_secret: 'd4e885f9aa839494f3927fd3fb244c2794e471a8',
	owner: 'Lzq2024',
	repo: 'gitalk',
	id: 'Tue Jun 11 2024 00:00:00 GMT+0800'
      }
   }
</script>

<script src="/js/comment/gitment.js"></script>


</html>