<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="lzq">
    
    
    
    
    
    
    <title>不同场景下MySQL的迁移方案 | 冰的技术专栏</title>
    <link href="http://bingfly.top" rel="prefetch" />

    
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/bootstrap.min.js"></script>

    
<script src="/js/aos.js"></script>

    
<script src="/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/avatar.jpg'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg,preview7.jpg,preview8.jpg,preview9.jpg,preview10.jpg,preview11.jpg,preview12.jpg,preview13.jpg,preview14.jpg,preview15.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="http://bingfly.top" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>

            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="http://bingfly.top">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">冰的技术专栏</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>分类
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/hexo-%E5%8D%9A%E5%AE%A2/">hexo+博客</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Python%E5%9F%BA%E7%A1%80/">Python基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Python%E9%9D%A2%E8%AF%95/">Python面试</a>
                        </li>
                        
                        
                        <li>
                            <a href="/categories">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-tags"></i>标签
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/tags/Python/">Python</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Shell/">Shell</a>
                        </li>
                        
                        <li>
                            <a href="/tags/Linux/">Linux</a>
                        </li>
                        
                        
                        <li>
                            <a href="/tags">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                <li class="">
                    <a href="/about">
                        <i class="fa fa-user"></i>关于我
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="http://bingfly.top">冰的技术专栏</a>
        >
        <span>不同场景下MySQL的迁移方案</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2024/06/11/%E6%80%BB%E7%BB%93/21%E3%80%81MySQL%E8%BF%81%E7%A7%BB/">不同场景下MySQL的迁移方案</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-tags"></i>
                
                <a href="/tags/MySQL/">MySQL</a>
                
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2024-06-11
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/21%E3%80%81MySQL%E8%BF%81%E7%A7%BB/">不同场景下MySQL的迁移方案</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2024-06-11
            </p>
            <p>
                
                <i class="fa fa-tags"></i>
                
                <a href="/tags/MySQL/">MySQL</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <h1 id="不同场景下MySQL的迁移方案"><a href="#不同场景下MySQL的迁移方案" class="headerlink" title="不同场景下MySQL的迁移方案"></a>不同场景下MySQL的迁移方案</h1><h2 id="一-、为什么要迁移"><a href="#一-、为什么要迁移" class="headerlink" title="一 、为什么要迁移"></a>一 、为什么要迁移</h2><p>MySQL 迁移是 DBA 日常维护中的一个工作。<strong>迁移，究其本义，无非是把实际存在的物体挪走，保证该物体的完整性以及延续性</strong>。就像柔软的沙滩上，两个天真无邪的小孩，把一堆沙子挪向其他地方，铸就内心神往的城堡。</p>
<h3 id="生产环境中，有以下情况需要做迁移工作，如下："><a href="#生产环境中，有以下情况需要做迁移工作，如下：" class="headerlink" title="生产环境中，有以下情况需要做迁移工作，如下："></a>生产环境中，有以下情况需要做迁移工作，如下：</h3><p><strong>1、磁盘空间不够</strong></p>
<p>比如一些老项目，选用的机型并不一定适用于数据库。随着时间的推移，硬盘很有可能出现短缺；</p>
<p><strong>2、业务出现瓶颈。</strong></p>
<p>比如项目中采用单机承担所有的读写业务，业务压力增大，不堪重负。如果 IO 压力在可接受的范围，会采用读写分离方案；</p>
<p><strong>3、机器出现瓶颈</strong></p>
<p>机器出现瓶颈主要在磁盘 IO 能力、内存、CPU，此时除了针对瓶颈做一些优化以外，选择迁移是不错的方案；</p>
<p><strong>4、项目改造</strong></p>
<p>某些项目的数据库存在跨机房的情况，可能会在不同机房中增加节点，或者把机器从一个机房迁移到另一个机房。再比如，不同业务共用同一台服务器，为了缓解服务器压力以及方便维护，也会做迁移。</p>
<p>一句话，迁移工作是不得已而为之。实施迁移工作，目的是让业务平稳持续地运行。</p>
<h2 id="二、MySQL-迁移方案概览"><a href="#二、MySQL-迁移方案概览" class="headerlink" title="二、MySQL 迁移方案概览"></a>二、MySQL 迁移方案概览</h2><p>MySQL 迁移无非是围绕着数据做工作，再继续延伸，无非就是在保证业务平稳持续地运行的前提下做备份恢复。那问题就在怎么快速安全地进行备份恢复。</p>
<p>一方面，<strong>备份。</strong>针对每个主节点的从节点或者备节点，都有备份。这个备份可能是全备，可能是增量备份。在线备份的方法，可能是使用 mysqldump，可能是 xtrabackup，还可能是 mydumper。针对小容量（10GB 以下）数据库的备份，我们可以使用 mysqldump。但针对大容量数据库（数百GB 或者 TB 级别），我们不能使用 mysqldump 备份，一方面，会产生锁；另一方面，耗时太长。这种情况，可以选择 xtrabackup 或者直接拷贝数据目录。直接拷贝数据目录方法，不同机器传输可以使用 rsync，耗时跟网络相关。使用 xtrabackup，耗时主要在备份和网络传输。如果有全备或者指定库的备份文件，这是获取备份的最好方法。如果备库可以容许停止服务，直接拷贝数据目录是最快的方法。如果备库不允许停止服务，我们可以使用 xtrabackup（不会锁定 InnoDB 表），这是完成备份的最佳折中办法。</p>
<p>另一方面，<strong>恢复。</strong>针对小容量（10GB 以下）数据库的备份文件，我们可以直接导入。针对大容量数据库（数百GB 或者 TB 级别）的恢复，拿到备份文件到本机以后，恢复不算困难。具体的恢复方法可以参考第三节。</p>
<h2 id="三、MySQL-迁移实战"><a href="#三、MySQL-迁移实战" class="headerlink" title="三、MySQL 迁移实战"></a>三、MySQL 迁移实战</h2><p>我们搞明白为什么要做迁移，以及迁移怎么做以后，接下来看看生产环境是怎样操作的。不同的应用场景，有不同的解决方案。</p>
<p>阅读具体的实战之前，假设和读者有如下约定：</p>
<p>1.为了保护隐私，本文中的服务器 IP 等信息经过处理；</p>
<p>2.如果服务器在同一机房，用服务器 IP 的 D 段代替服务器，具体的 IP 请参考架构图；</p>
<p>3.如果服务器在不同机房，用服务器 IP 的 C 段 和 D 段代替服务器，具体的 IP 请参考架构图；</p>
<p>4.每个场景给出方法，但不会详细地给出每一步执行什么命令，因为一方面，这会导致文章过长；另一方面，我认为只要知道方法，具体的做法就会迎面扑来的，只取决于掌握知识的程度和获取信息的能力；</p>
<p>5.实战过程中的注意事项请参考第四节。</p>
<h3 id="3-1、-场景一：一主一从结构迁移从库"><a href="#3-1、-场景一：一主一从结构迁移从库" class="headerlink" title="3.1、 场景一：一主一从结构迁移从库"></a>3.1、 场景一：一主一从结构迁移从库</h3><p>遵循从易到难的思路，我们从简单的结构入手。A 项目，原本是一主一从结构。101 是主节点，102 是从节点。因业务需要，把 102 从节点迁移至 103，架构图如图一。102 从节点的数据容量过大，不能使用 mysqldump 的形式备份。和研发沟通后，形成一致的方案。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104940.jpg" alt="MySQL,迁移,方案"><br>图一 一主一从结构迁移从库架构图</p>
<h4 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h4><p>1.研发将 102 的读业务切到主库；</p>
<p>2.确认 102 MySQL 状态（主要看 PROCESS LIST），观察机器流量，确认无误后，停止 102 从节点的服务；</p>
<p>3.103 新建 MySQL 实例，建成以后，停止 MySQL 服务，并且将整个数据目录 mv 到其他地方做备份；</p>
<p>4.将 102 的整个 mysql 数据目录使用 rsync 拷贝到 103；</p>
<p>5.拷贝的同时，在 101 授权，使 103 有拉取 binlog 的权限（REPLICATION SLAVE, REPLICATION CLIENT）；</p>
<p>6.待拷贝完成，修改 103 配置文件中的 server_id，注意不要和 102 上的一致；</p>
<p>7.在 103 启动 MySQL 实例，注意配置文件中的数据文件路径以及数据目录的权限；</p>
<p>8.进入 103 MySQL 实例，使用 SHOW SLAVE STATUS 检查从库状态，可以看到 Seconds_Behind_Master 在递减；</p>
<p>9.Seconds_Behind_Master 变为 0 后，表示同步完成，此时可以用 pt-table-checksum 检查 101 和 103 的数据一致，但比较耗时，而且对主节点有影响，可以和开发一起进行数据一致性的验证；</p>
<p>10.和研发沟通，除了做数据一致性验证外，还需要验证账号权限，以防业务迁回后访问出错；</p>
<p>11.做完上述步骤，可以和研发协调，把 101 的部分读业务切到 103，观察业务状态；</p>
<p>12.如果业务没有问题，证明迁移成功。</p>
<h3 id="3-2、场景二：一主一从结构迁移指定库"><a href="#3-2、场景二：一主一从结构迁移指定库" class="headerlink" title="3.2、场景二：一主一从结构迁移指定库"></a>3.2、场景二：一主一从结构迁移指定库</h3><p>我们知道一主一从只迁移从库怎么做之后，接下来看看怎样同时迁移主从节点。因不同业务同时访问同一服务器，导致单个库压力过大，还不便管理。于是，打算将主节点 101 和从节点 102 同时迁移至新的机器 103 和 104，103 充当主节点，104 充当从节点，架构图如图二。此次迁移只需要迁移指定库，这些库容量不是太大，并且可以保证数据不是实时的。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104944.jpg" alt="MySQL,迁移,方案"><br>图二 一主一从结构迁移指定库架构图</p>
<h4 id="步骤：-1"><a href="#步骤：-1" class="headerlink" title="步骤："></a>步骤：</h4><p>1、103 和 104 新建实例，搭建主从关系，此时的主节点和从节点处于空载；</p>
<p>2、102 导出数据，正确的做法是配置定时任务，在业务低峰做导出操作，此处选择的是 mysqldump；</p>
<p>3、102 收集指定库需要的账号以及权限；</p>
<p>4、102 导出数据完毕，使用 rsync 传输到 103，必要时做压缩操作；</p>
<p>5、103 导入数据，此时数据会自动同步到 104，监控服务器状态以及 MySQL 状态；</p>
<p>6、103 导入完成，104 同步完成，103 根据 102 收集的账号授权，完成后，通知研发检查数据以及账户权限；</p>
<p>7、上述完成后，可研发协作，将 101 和 102 的业务迁移到 103 和 104，观察业务状态；</p>
<p>8、如果业务没有问题，证明迁移成功。</p>
<h3 id="3-3、场景三-：一主一从结构双边迁移指定库"><a href="#3-3、场景三-：一主一从结构双边迁移指定库" class="headerlink" title="3.3、场景三 ：一主一从结构双边迁移指定库"></a>3.3、场景三 ：一主一从结构双边迁移指定库</h3><p>接下来看看一主一从结构双边迁移指定库怎么做。同样是因为业务共用，导致服务器压力大，管理混乱。于是，打算将主节点 101 和从节点 102 同时迁移至新的机器 103、104、105、106，103 充当 104 的主节点，104 充当 103 的从节点，105 充当 106 的主节点，106 充当 105 的从节点，架构图如图三。此次迁移只需要迁移指定库，这些库容量不是太大，并且可以保证数据不是实时的。我们可以看到，此次迁移和场景二很类似，无非做了两次迁移。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104947.jpg" alt="MySQL,迁移,方案"><br>图三 一主一从结构双边迁移指定库架构图</p>
<h4 id="步骤：-2"><a href="#步骤：-2" class="headerlink" title="步骤："></a>步骤：</h4><p>1、103 和 104 新建实例，搭建主从关系，此时的主节点和从节点处于空载；</p>
<p>2、102 导出 103 需要的指定库数据，正确的做法是配置定时任务，在业务低峰做导出操作，此处选择的是 mysqldump；</p>
<p>3、102 收集 103 需要的指定库需要的账号以及权限；</p>
<p>4、102 导出103 需要的指定库数据完毕，使用 rsync 传输到 103，必要时做压缩操作；</p>
<p>5、103 导入数据，此时数据会自动同步到 104，监控服务器状态以及 MySQL 状态；</p>
<p>6、103 导入完成，104 同步完成，103 根据 102 收集的账号授权，完成后，通知研发检查数据以及账户权限；</p>
<p>7、上述完成后，和研发协作，将 101 和 102 的业务迁移到 103 和 104，观察业务状态；</p>
<p>8、105 和 106 新建实例，搭建主从关系，此时的主节点和从节点处于空载；<br>9、102 导出 105 需要的指定库数据，正确的做法是配置定时任务，在业务低峰做导出操作，此处选择的是 mysqldump；</p>
<p>10、102 收集 105 需要的指定库需要的账号以及权限；</p>
<p>11、102 导出 105 需要的指定库数据完毕，使用 rsync 传输到 105，必要时做压缩操作；</p>
<p>12、105 导入数据，此时数据会自动同步到 106，监控服务器状态以及 MySQL 状态；</p>
<p>13、105 导入完成，106 同步完成，105 根据 102 收集的账号授权，完成后，通知研发检查数据以及账户权限；</p>
<p>14、上述完成后，和研发协作，将 101 和 102 的业务迁移到 105 和 106，观察业务状态；</p>
<p>15、如果所有业务没有问题，证明迁移成功。</p>
<h3 id="3-4、场景四：一主一从结构完整迁移主从"><a href="#3-4、场景四：一主一从结构完整迁移主从" class="headerlink" title="3.4、场景四：一主一从结构完整迁移主从"></a>3.4、场景四：一主一从结构完整迁移主从</h3><p>接下来看看一主一从结构完整迁移主从怎么做。和场景二类似，不过此处是迁移所有库。因 101 主节点 IO 出现瓶颈，打算将主节点 101 和从节点 102 同时迁移至新的机器 103 和 104，103 充当主节点，104 充当从节点。迁移完成后，以前的主节点和从节点废弃，架构图如图四。此次迁移是全库迁移，容量大，并且需要保证实时。这次的迁移比较特殊，因为采取的策略是先替换新的从库，再替换新的主库。所以做法稍微复杂些。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104949.jpg" alt="MySQL,迁移,方案"><br>图四 一主一从结构完整迁移主从架构图</p>
<h4 id="步骤：-3"><a href="#步骤：-3" class="headerlink" title="步骤："></a>步骤：</h4><p>1、研发将 102 的读业务切到主库；</p>
<p>2、确认 102 MySQL 状态（主要看 PROCESS LIST，MASTER STATUS），观察机器流量，确认无误后，停止 102 从节点的服务；<br>3、104 新建 MySQL 实例，建成以后，停止 MySQL 服务，并且将整个数据目录 mv 到其他地方做备份，注意，此处操作的是 104，也就是未来的从库；<br>4、将 102 的整个 mysql 数据目录使用 rsync 拷贝到 104；<br>5、拷贝的同时，在 101 授权，使 104 有拉取 binlog 的权限（REPLICATION SLAVE, REPLICATION CLIENT）；<br>6、待拷贝完成，修改 104 配置文件中的 server_id，注意不要和 102 上的一致；<br>7、在 104 启动 MySQL 实例，注意配置文件中的数据文件路径以及数据目录的权限；<br>8、进入 104 MySQL 实例，使用 SHOW SLAVE STATUS 检查从库状态，可以看到 Seconds_Behind_Master 在递减；<br>9、Seconds_Behind_Master 变为 0 后，表示同步完成，此时可以用 pt-table-checksum 检查 101 和 104 的数据一致，但比较耗时，而且对主节点有影响，可以和开发一起进行数据一致性的验证；<br>10、除了做数据一致性验证外，还需要验证账号权限，以防业务迁走后访问出错；<br>11、和研发协作，将之前 102 从节点的读业务切到 104；<br>12、利用 102 的数据，将 103 变为 101 的从节点，方法同上；<br>13、接下来到了关键的地方了，我们需要把 104 变成 103 的从库；<br>- 104 STOP SLAVE；<br>- 103 STOP SLAVE IO_THREAD;<br>- 103 STOP SLAVE SQL_THREAD，记住 MASTER_LOG_FILE 和 MASTER_LOG_POS；<br>- 104<strong>START SLAVE UNTIL</strong>到上述 MASTER_LOG_FILE 和 MASTER_LOG_POS；<br>- 104 再次 STOP SLAVE；<br>- 104 RESET SLAVE ALL 清除从库配置信息；<br>- 103 SHOW MASTER STATUS，记住 MASTER_LOG_FILE 和 MASTER_LOG_POS；<br>- 103 授权给 104 访问 binlog 的权限；<br>- 104 CHANGE MASTER TO 103；<br>- 104 重启 MySQL，因为 RESET SLAVE ALL 后，查看 SLAVE STATUS，Master_Server_Id 仍然为 101，而不是 103；<br>- 104 MySQL 重启后，SLAVE 回自动重启，此时查看 IO_THREAD 和 SQL_THREAD 是否为 YES；<br>- 103 START SLAVE；<br>- 此时查看 103 和 104 的状态，可以发现，以前 104 是 101 的从节点，如今变成 103 的从节点了。<br>14、业务迁移之前，断掉 103 和 101 的同步关系；<br>15、做完上述步骤，可以和研发协调，把 101 的读写业务切回 102，读业务切到 104。需要注意的是，此时 101 和 103 均可以写，需要保证 101 在没有写入的情况下切到 103，可以使用 FLUSH TABLES WITH READ LOCK 锁住 101，然后业务切到 103。注意，一定要业务低峰执行，切记；<br>16、切换完成后，观察业务状态；<br>17、如果业务没有问题，证明迁移成功。</p>
<h3 id="3-5、场景五：双主结构跨机房迁移"><a href="#3-5、场景五：双主结构跨机房迁移" class="headerlink" title="3.5、场景五：双主结构跨机房迁移"></a>3.5、场景五：双主结构跨机房迁移</h3><p>接下来看看双主结构跨机房迁移怎么做。某项目出于容灾考虑，使用了跨机房，采用了双主结构，双边均可以写。因为磁盘空间问题，需要对 A 地的机器进行替换。打算将主节点 1.101 和从节点 1.102 同时迁移至新的机器 1.103 和 1.104，1.103 充当主节点，1.104 充当从节点。B 地的 2.101 和 2.102 保持不变，但迁移完成后，1.103 和 2.101 互为双主。架构图如图五。因为是双主结构，两边同时写，如果要替换主节点，单方必须有节点停止服务。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104952.jpg" alt="MySQL,迁移,方案"><br>图五 双主结构跨机房迁移架构图</p>
<h4 id="步骤：-4"><a href="#步骤：-4" class="headerlink" title="步骤："></a>步骤：</h4><p>1、1.103 和 1.104 新建实例，搭建主从关系，此时的主节点和从节点处于空载；<br>2、确认 1.102 MySQL 状态（主要看 PROCESS LIST），注意观察 MASTER STATUS 不再变化。观察机器流量，确认无误后，停止 1.102 从节点的服务；<br>3、1.103 新建 MySQL 实例，建成以后，停止 MySQL 服务，并且将整个数据目录 mv 到其他地方做备份；<br>4、将 1.102 的整个 mysql 数据目录使用 rsync 拷贝到 1.103；<br>5、拷贝的同时，在 1.101 授权，使 1.103 有拉取 binlog 的权限（REPLICATION SLAVE, REPLICATION CLIENT）；<br>6、待拷贝完成，修改 1.103 配置文件中的 server_id，注意不要和 1.102 上的一致；<br>7、在 1.103 启动 MySQL 实例，注意配置文件中的数据文件路径以及数据目录的权限；<br>8、进入 1.103 MySQL 实例，使用 SHOW SLAVE STATUS 检查从库状态，可以看到 Seconds_Behind_Master 在递减；<br>9、Seconds_Behind_Master 变为 0 后，表示同步完成，此时可以用 pt-table-checksum 检查 1.101 和 1.103 的数据一致，但比较耗时，而且对主节点有影响，可以和开发一起进行数据一致性的验证；<br>10、我们使用相同的办法，使 1.104 变成 1.103 的从库；<br>11、和研发沟通，除了做数据一致性验证外，还需要验证账号权限，以防业务迁走后访问出错；<br>12、此时，我们要做的就是将 1.103 变成 2.101 的从库，具体的做法可以参考场景四；<br>13、需要注意的是，1.103 的单双号配置需要和 1.101 一致；<br>14、做完上述步骤，可以和研发协调，把 1.101 的读写业务切到 1.103，把 1.102 的读业务切到 1.104。观察业务状态；<br>15、如果业务没有问题，证明迁移成功。</p>
<h3 id="3-6、场景六：多实例跨机房迁移"><a href="#3-6、场景六：多实例跨机房迁移" class="headerlink" title="3.6、场景六：多实例跨机房迁移"></a>3.6、场景六：多实例跨机房迁移</h3><p>接下来我们看看多实例跨机房迁移证明做。每台机器的实例关系，我们可以参考图六。此次迁移的目的是为了做数据修复。在 2.117 上建立 7938 和 7939 实例，替换之前数据异常的实例。因为业务的原因，某些库只在 A 地写，某些库只在 B 地写，所以存在同步过滤的情况。</p>
<p><img src="https://gitee.com/julyjo/blogimage/raw/master/img/20210127104955.jpg" alt="MySQL,迁移,方案"><br>图六 多实例跨机房迁移架构图</p>
<h4 id="步骤：-5"><a href="#步骤：-5" class="headerlink" title="步骤："></a>步骤：</h4><p>1、1.113 针对 7936 实例使用 innobackupex 做数据备份，注意需要指定数据库，并且加上 slave-info 参数；</p>
<p>2、备份完成后，将压缩文件拷贝到 2.117；<br>3、2.117 创建数据目录以及配置文件涉及的相关目录；<br>4、2.117 使用 innobackupex 恢复日志；<br>5、2.117 使用 innobackupex 拷贝数据；<br>6、2.117 修改配置文件，注意如下参数：replicate-ignore-db、innodb_file_per_table &#x3D; 1、read_only &#x3D; 1、 server_id；<br>7、2.117 更改数据目录权限；<br>8、1.112 授权，使 2.117 有拉取 binlog 的权限（REPLICATION SLAVE, REPLICATION CLIENT）；<br>9、2.117 CHANGE MASTE TO 1.112，LOG FILE 和 LOG POS 参考 xtrabackup_slave_info；<br>10、2.117 START SLAVE，查看从库状态；</p>
<p>11、2.117 上建立 7939 的方法类似，不过配置文件需要指定 replicate-wild-do-table；<br>12、和开发一起进行数据一致性的验证和验证账号权限，以防业务迁走后访问出错；<br>13、做完上述步骤，可以和研发协调，把相应业务迁移到 2.117 的 7938 实例和 7939 实例。观察业务状态；<br>14、如果业务没有问题，证明迁移成功。</p>
<h2 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a>四、注意事项</h2><p>介绍完不同场景的迁移方案，需要注意如下几点：</p>
<p>1、数据库迁移，如果涉及事件，记住主节点打开 event_scheduler 参数；<br>2、不管什么场景下的迁移，都要随时关注服务器状态，比如磁盘空间，网络抖动；另外，对业务的持续监控也是必不可少的；<br>3、CHANGE MASTER TO 的 LOG FILE 和 LOG POS 切记不要找错，如果指定错了，带来的后果就是数据不一致；<br>4、执行脚本不要在 $HOME 目录，记住在数据目录；<br>5、迁移工作可以使用脚本做到自动化，但不要弄巧成拙，任何脚本都要经过测试；<br>6、每执行一条命令都要三思和后行，每个命令的参数含义都要搞明白；<br>7、多实例环境下，关闭 MySQL 采用 mysqladmin 的形式，不要把正在使用的实例关闭了；<br>8、从库记得把 read_only &#x3D; 1 加上，这会避免很多问题；<br>9、每台机器的 server_id 必须保证不一致，否则会出现同步异常的情况；<br>10、正确配置 replicate-ignore-db 和 replicate-wild-do-table；<br>11、新建的实例记得把 innodb_file_per_table 设置为 1，上述中的部分场景，因为之前的实例此参数为 0，导致 ibdata1 过大，备份和传输都消耗了很多时间；<br>12、使用 gzip 压缩数据时，注意压缩完成后，gzip 会把源文件删除。<br>13、所有的操作务必在从节点或者备节点操作，如果在主节点操作，主节点很可能会宕机；</p>
<p>14、xtrabackup 备份不会锁定 InnoDB 表，但会锁定 MyISAM 表。所以，操作之前记得检查下当前数据库的表是否有使用 MyISAM 存储引擎的，如果有，要么单独处理，要么更改表的 Engine；</p>
<h2 id="五、技巧"><a href="#五、技巧" class="headerlink" title="五、技巧"></a>五、技巧</h2><p>在 MySQL 迁移实战中，有如下技巧可以使用：</p>
<p>1、任何迁移 LOG FILE 以 relay_master_log_file（正在同步 master 上的 binlog 日志名）为准，LOG POS 以 exec_master_log_pos（正在同步当前 binlog 日志的 POS 点）为准；<br>2、使用 rsync 拷贝数据，可以结合 expect、nohup 使用，绝对是绝妙组合；<br>3、在使用 innobackupex 备份数据的同时可以使用 gzip 进行压缩；<br>4、在使用 innobackupex 备份数据，可以加上 –slave-info 参数，方便做从库；<br>5、在使用 innobackupex 备份数据，可以加上 –throttle 参数，限制 IO，减少对业务的影响。还可以加上 –parallel&#x3D;n 参数，加快备份，但需要注意的是，使用 tar 流压缩，–parallel 参数无效。</p>
<p>6、做数据的备份与恢复，可以把待办事项列个清单，画个流程，然后把需要执行的命令提前准备好；<br>7、本地快速拷贝文件夹，有个不错的方法，使用 rsync，加上如下参数：-avhW –no-compress –progress；<br>8、 不同分区之间快速拷贝数据，可以使用 dd。或者用一个更靠谱的方法，备份到硬盘，然后放到服务器上。异地还有更绝的，直接快递硬盘。</p>
<h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>本文从为什么要迁移讲起，接下来讲了迁移方案，然后讲解了不同场景下的迁移实战，最后给出了注意事项以及实战技巧。归纳起来，也就以下几点：</p>
<p>第一，迁移的目的是让业务平稳持续地运行；</p>
<p>第二，迁移的核心是怎么延续主从同步，我们需要在不同服务器和不同业务之间找到方案；</p>
<p>第三，业务切换需要考虑不同 MySQL 服务器之间的权限问题；需要考虑不同机器读写分离的顺序以及主从关系；需要考虑跨机房调用对业务的影响。</p>

    </div>
</article>


<div id="comments-template"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script>
	if(!window.commentConfig) {
      window.commentConfig = {}
      window.commentConfig.title = '不同场景下MySQL的迁移方案'
    }
</script>

                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            lzq
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/avatar.jpg" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"></p>
        </div>
    </div>
</aside>
    
    <aside id="sidebar-recent_comments">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-comments"></i>
            最新评论
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day91-100/95.%E4%BD%BF%E7%94%A8Django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/">Django开发商业项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day46-60/46.Django%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">Django快速上手</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Python%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-%E5%9F%BA%E7%A1%80%E7%AF%87-2020/">Python基础题</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E8%8B%B1%E8%AF%AD%E9%9D%A2%E8%AF%95/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98%E5%9B%9E%E7%AD%94/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%94%A8%E5%87%BD%E6%95%B0%E8%BF%98%E6%98%AF%E7%94%A8%E5%A4%8D%E6%9D%82%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E7%8E%A9%E8%BD%ACPyCharm/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83%E7%A4%BA%E4%BE%8B/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E4%BA%86Python/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E5%B8%B8%E8%A7%81%E5%8F%8D%E7%88%AC%E7%AD%96%E7%95%A5%E5%8F%8A%E5%BA%94%E5%AF%B9%E6%96%B9%E6%A1%88/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day01-15/13.%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day36-45/38.SQL%E8%AF%A6%E8%A7%A3%E4%B9%8BDML/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day81-90/86.K-%E5%9D%87%E5%80%BC%E8%81%9A%E7%B1%BB/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day91-100/94.%E7%BD%91%E7%BB%9CAPI%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/13/Python-100-Days-master/Day91-100/95.%E4%BD%BF%E7%94%A8Django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/">Django开发商业项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/%E7%95%AA%E5%A4%96%E7%AF%87/%E8%8B%B1%E8%AF%AD%E9%9D%A2%E8%AF%95/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/old/javascript/example06/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/example_of_jquery_4/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/js_practice_7/"></a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2024/12/12/Python-100-Days-master/Day21-30/code/new/web1901/shopping_cart/"></a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">

                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/21%E3%80%81MySQL%E8%BF%81%E7%A7%BB/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/21%E3%80%81MySQL%E8%BF%81%E7%A7%BB/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                
                
                <li>
                    <a href="/2024/06/11/%E6%80%BB%E7%BB%93/21%E3%80%81MySQL%E8%BF%81%E7%A7%BB/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
                
            </ul>
            <div class="tab-content">
                
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
    <a href="/tags/Python/" style="font-size: 11.739259042681281px;" class="tag-cloud-link">Python</a>
    
    <a href="/tags/Shell/" style="font-size: 13.050403330505532px;" class="tag-cloud-link">Shell</a>
    
    <a href="/tags/Linux/" style="font-size: 16.175438221901594px;" class="tag-cloud-link">Linux</a>
    
    <a href="/tags/Apache/" style="font-size: 18.412873424271275px;" class="tag-cloud-link">Apache</a>
    
    <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 14.014669806392943px;" class="tag-cloud-link">网络</a>
    
    <a href="/tags/Ceph/" style="font-size: 9.045628474441656px;" class="tag-cloud-link">Ceph</a>
    
    <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 17.911685377894138px;" class="tag-cloud-link">阿里云</a>
    
    <a href="/tags/K8s/" style="font-size: 14.913628106476615px;" class="tag-cloud-link">K8s</a>
    
    <a href="/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" style="font-size: 14.32133118154265px;" class="tag-cloud-link">灰度发布</a>
    
    <a href="/tags/MySQL/" style="font-size: 8.466740289636554px;" class="tag-cloud-link">MySQL</a>
    
    <a href="/tags/KVM/" style="font-size: 18.191997056410447px;" class="tag-cloud-link">KVM</a>
    
    <a href="/tags/OpenStack/" style="font-size: 15.18675559268318px;" class="tag-cloud-link">OpenStack</a>
    
    <a href="/tags/Docker/" style="font-size: 14.851239901481417px;" class="tag-cloud-link">Docker</a>
    
    <a href="/tags/ELK/" style="font-size: 10.52222668406729px;" class="tag-cloud-link">ELK</a>
    
    <a href="/tags/Ansible/" style="font-size: 13.112930955134035px;" class="tag-cloud-link">Ansible</a>
    
    <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 10.6620879774444px;" class="tag-cloud-link">负载均衡</a>
    
    <a href="/tags/Radis%E3%80%81Mongodb/" style="font-size: 18.112804187796257px;" class="tag-cloud-link">Radis、Mongodb</a>
    
    <a href="/tags/Nginx/" style="font-size: 10.520581036969414px;" class="tag-cloud-link">Nginx</a>
    
    <a href="/tags/Tomcat/" style="font-size: 10.162285039267267px;" class="tag-cloud-link">Tomcat</a>
    
    <a href="/tags/DevOps/" style="font-size: 17.20976429961221px;" class="tag-cloud-link">DevOps</a>
    
    <a href="/tags/Jenkins/" style="font-size: 13.567806165404079px;" class="tag-cloud-link">Jenkins</a>
    
    <a href="/tags/Prometheus/" style="font-size: 15.829504134465758px;" class="tag-cloud-link">Prometheus</a>
    
    <a href="/tags/Django/" style="font-size: 10.882323157444318px;" class="tag-cloud-link">Django</a>
    
    <a href="/tags/Selenium/" style="font-size: 10.380824078011264px;" class="tag-cloud-link">Selenium</a>
    
    <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 9.269158478689073px;" class="tag-cloud-link">爬虫</a>
    
    <a href="/tags/Scrapy/" style="font-size: 9.422067475838386px;" class="tag-cloud-link">Scrapy</a>
    
</div>
                
                
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="https://www.runoob.com/" target="_blank">菜鸟教程</a>
    </li>
    
    <li>
        <a href="https://www.csdn.net/" target="_blank">CSDN</a>
    </li>
    
    <li>
        <a href="https://nowcoder.com/" target="_blank">牛客网</a>
    </li>
    
    <li>
        <a href="https://www.bilibili.com/" target="_blank">B站</a>
    </li>
    
    <li>
        <a href="https://leetcode-cn.com/" target="_blank">Leetcode</a>
    </li>
    
    <li>
        <a href="https://www.heroku.com/" target="_blank">Heroku</a>
    </li>
    
</div>
                
                
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/lzq2024/" target="_blank">Github</a>
    </li>
    
    <li>
        <a href="https://gitee.com/lzq2024" target="_blank">Gitee</a>
    </li>
    
    <li>
        <a href="https://www.zhihu.com/people/yr1d3j/activities" target="_blank">知乎</a>
    </li>
    
</div>
                
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 lzq Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/Lzq2024" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
</body>

<script src="/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/imgs/slide/background',
      ext: 'jpg',
      maxCount: '7'
    }
</script>

<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>



<script src="/js/oni.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  if(window.commentConfig) {
     window.commentConfig.client_id = 'Ov23lijIsO699goQayhr'
     window.commentConfig.client_secret = 'd4e885f9aa839494f3927fd3fb244c2794e471a8'
     window.commentConfig.owner = 'Lzq2024'
     window.commentConfig.repo = 'gitalk'
     window.commentConfig.id = 'Tue Jun 11 2024 00:00:00 GMT+0800'
   } else {
    window.commentConfig = {
 	client_id: 'Ov23lijIsO699goQayhr',
 	client_secret: 'd4e885f9aa839494f3927fd3fb244c2794e471a8',
	owner: 'Lzq2024',
	repo: 'gitalk',
	id: 'Tue Jun 11 2024 00:00:00 GMT+0800'
      }
   }
</script>

<script src="/js/comment/gitment.js"></script>


</html>